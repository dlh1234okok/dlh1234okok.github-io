<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>这夜景</title>
  
  <subtitle>blog</subtitle>
  <link href="/dlh1234okok.github.io/atom.xml" rel="self"/>
  
  <link href="http://www.dlhblog.online/"/>
  <updated>2018-11-03T09:42:04.147Z</updated>
  <id>http://www.dlhblog.online/</id>
  
  <author>
    <name>li-hong</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Shiro-密码散列加密</title>
    <link href="http://www.dlhblog.online/2018/11/03/Shiro-%E5%AF%86%E7%A0%81%E6%95%A3%E5%88%97%E5%8A%A0%E5%AF%86/"/>
    <id>http://www.dlhblog.online/2018/11/03/Shiro-密码散列加密/</id>
    <published>2018-11-03T09:12:55.000Z</published>
    <updated>2018-11-03T09:42:04.147Z</updated>
    
    <content type="html"><![CDATA[<p>​    在数据库中，密码应该避免以明文方式存储，散列算法一般用于生成数据的摘要信息，是一种不可逆的算法，一般适合存储密码之类的数据，常见的散列算法如MD5、SHA等。</p><p>​    Shiro也为我们提供了多种散列算法，这里我们使用的是MD5</p><h1 id="测试MD5加密"><a href="#测试MD5加密" class="headerlink" title="测试MD5加密"></a>测试MD5加密</h1><p>Shiro提供了<code>Hd5Hash</code>这个类，其中通过重载构造器进行不同程度的加密。</p><h2 id="一次MD5加密"><a href="#一次MD5加密" class="headerlink" title="一次MD5加密"></a>一次MD5加密</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Md5Hash md5Hash = <span class="keyword">new</span> Md5Hash(passWord);</span><br><span class="line">System.out.println(md5Hash.toString());</span><br></pre></td></tr></table></figure><h2 id="加盐"><a href="#加盐" class="headerlink" title="加盐"></a>加盐</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Md5Hash md5Hash2 = <span class="keyword">new</span> Md5Hash(passWord,<span class="string">"amy"</span>);</span><br><span class="line">System.out.println(md5Hash2.toString());</span><br></pre></td></tr></table></figure><p>​    一些md5解密网站很容易的通过散列值得到密码，即如果直接对密码进行散列相对来说破解更容易，此时我们可以加一些只有系统知道的干扰数据，如用户名或ID（即盐）；这样散列的对象是“密码+用户名”，这样生成的散列值相对来说更难破解。</p><h2 id="加盐-散列次数-2"><a href="#加盐-散列次数-2" class="headerlink" title="加盐+散列次数*2"></a>加盐+散列次数*2</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Md5Hash md5Hash3 = <span class="keyword">new</span> Md5Hash(passWord,<span class="string">"amy"</span>,<span class="number">2</span>);</span><br><span class="line">System.out.println(md5Hash3.toString());</span><br></pre></td></tr></table></figure><p>​    这时的散列格式或许为MD5(MD5())，将密码+用户名的散列密码再进行散列加密，此时作为存储密码将更加复杂，提高安全性。</p><h1 id="在Realm中应用"><a href="#在Realm中应用" class="headerlink" title="在Realm中应用"></a>在Realm中应用</h1><p>将盐和散列后的值存在数据库中，自动realm从数据库取出盐和加密后的值由shiro完成密码校验。</p><h2 id="添加配置文件指定realm和散列加密信息"><a href="#添加配置文件指定realm和散列加密信息" class="headerlink" title="添加配置文件指定realm和散列加密信息"></a>添加配置文件指定realm和散列加密信息</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[main]</span></span><br><span class="line"><span class="comment">#定义凭证匹配器</span></span><br><span class="line"><span class="attr">credentialsMatcher</span>=org.apache.shiro.authc.credential.HashedCredentialsMatcher</span><br><span class="line"><span class="comment">#散列算法</span></span><br><span class="line">credentialsMatcher.hashAlgorithmName=md5</span><br><span class="line"><span class="comment">#散列次数</span></span><br><span class="line">credentialsMatcher.hashIterations=1</span><br><span class="line"><span class="comment">#将凭证匹配器设置到realm</span></span><br><span class="line"><span class="attr">myRealm</span>=com.mani.PasswordRealm</span><br><span class="line">myRealm.credentialsMatcher=$credentialsMatcher</span><br><span class="line">securityManager.realms=$myRealm</span><br></pre></td></tr></table></figure><h2 id="自定义Realm"><a href="#自定义Realm" class="headerlink" title="自定义Realm"></a>自定义Realm</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">   <span class="comment">//获取用户名</span></span><br><span class="line">   String principal = (String) token.getPrincipal();</span><br><span class="line">   <span class="comment">// 模拟数据库中的用户名</span></span><br><span class="line">   <span class="keyword">if</span>(!<span class="string">"zhangsan"</span>.equals(principal))&#123;</span><br><span class="line">      <span class="comment">//表示找不到用户,返回空认证信息</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 模拟数据库中的密码</span></span><br><span class="line">   String password = <span class="string">"2a238413f0931a219bf70721c8e741d8"</span>;</span><br><span class="line">   <span class="comment">// 盐,在数据库中存储的</span></span><br><span class="line">   String salt = <span class="string">"zhangsan"</span>;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 返回认证信息由父类AuthenticatingRealm进行认证</span></span><br><span class="line"><span class="comment">    * 返回认证信息的时候需要把盐也一并的传过去</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   SimpleAuthenticationInfo simpleAuthenticationInfo = <span class="keyword">new</span> SimpleAuthenticationInfo(principal, password, ByteSource.Util.bytes(salt),getName());</span><br><span class="line">   <span class="keyword">return</span> simpleAuthenticationInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进行认证测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuthenticate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    <span class="comment">// 判断当前用户未认证</span></span><br><span class="line">    <span class="keyword">if</span> (!subject.isAuthenticated()) &#123;</span><br><span class="line">        <span class="comment">// token中的参数相当于用户登录传入的账户和密码</span></span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"zhangsan"</span>, <span class="string">"root"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 登录</span></span><br><span class="line">            subject.login(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 输出认证信息：true或false</span></span><br><span class="line">        System.out.println(subject.isAuthenticated());</span><br><span class="line">        <span class="comment">// 登出</span></span><br><span class="line">        subject.logout();</span><br><span class="line">        System.out.println(subject.isAuthenticated());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果：<img src="/dlh1234okok.github.io/2018/11/03/Shiro-密码散列加密/1.jpg" alt=""></p><p>AuthenticatingRealm会将我们传入的密码进行加盐散列加密后与模拟数据库中的密码进行匹配…</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    在数据库中，密码应该避免以明文方式存储，散列算法一般用于生成数据的摘要信息，是一种不可逆的算法，一般适合存储密码之类的数据，常见的散列算法如MD5、SHA等。&lt;/p&gt;
&lt;p&gt;​    Shiro也为我们提供了多种散列算法，这里我们使用的是MD5&lt;/p&gt;
&lt;h1 i
      
    
    </summary>
    
      <category term="Shiro" scheme="http://www.dlhblog.online/categories/Shiro/"/>
    
    
  </entry>
  
  <entry>
    <title>Shiro框架-开始</title>
    <link href="http://www.dlhblog.online/2018/11/03/Shiro%E6%A1%86%E6%9E%B6/"/>
    <id>http://www.dlhblog.online/2018/11/03/Shiro框架/</id>
    <published>2018-11-03T07:33:55.000Z</published>
    <updated>2018-11-03T09:05:14.637Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>​    Apache Shiro是一个强大易用的<strong>Java安全框架</strong>，提供了认证、授权、加密和会话管理功能，相比于Spring Security，Shiro的功能可能并没有那么强大，但是使用相对于更加轻便。</p><p>​    Shiro可以非常容易的开发出足够好的应用，其不仅可以用在JavaSE环境，也可以用在JavaEE环境。Shiro可以帮助我们完成：认证、授权、加密、会话管理、与Web集成、缓存等。</p><p><strong>Authentication</strong>：身份认证/登录，验证用户是不是拥有相应的身份；</p><p><strong>Authorization</strong>：授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能做事情，常见的如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限；</p><p>Session Manager：会话管理，即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通JavaSE环境的，也可以是如Web环境的；</p><p>Cryptography：加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储；</p><p>Web Support：Web支持，可以非常容易的集成到Web环境；</p><p>Caching：缓存，比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率；</p><p>Concurrency：shiro支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；</p><p>Testing：提供测试支持；</p><p>Run As：允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；</p><p>Remember Me：记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了。</p><h1 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h1><h2 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h2><p>​    subject在这里其基本意思是“当前操作用户”，但是在安全领域中，subject即可以是人，也可以是第三方进程，网络爬虫，机器人…在Shiro集成的环境中在代码的任何地方可以轻松的获取Shiro Subject。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = SecurityUtils.getSubject();</span><br></pre></td></tr></table></figure><p>​    一旦获得Subject，你就可以立即获得你希望用Shiro为当前用户做的90%的事情，如登录、登出、访问会话、执行授权检查等。</p><h2 id="SecurityManager"><a href="#SecurityManager" class="headerlink" title="SecurityManager"></a>SecurityManager</h2><p>​    Subject的“幕后”推手是SecurityManager。Subject代表了当前用户的安全操作，SecurityManager则管理所有用户的安全操作。它是Shiro框架的核心，充当“保护伞”，引用了多个内部嵌套安全组件，它们形成了对象图。但是，一旦SecurityManager及其内部对象图配置好，它就会退居幕后。</p><h2 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h2><p>​    Realm充当了Shiro与应用安全数据间的“<strong>桥梁</strong>”或者“<strong>连接器</strong>”。也就是说，当切实与像用户帐户这类安全相关数据进行交互，执行认证（登录）和授权（访问控制）时，Shiro会从应用配置的Realm中查找很多内容。</p><p>​    从这个意义上讲，Realm实质上是一个安全相关的DAO：它封装了数据源的连接细节，并在需要时将相关数据提供给Shiro。当配置Shiro时，你必须至少指定一个Realm，用于认证和（或）授权。配置多个Realm是可以的，但是至少需要一个。</p><p>​    Realm 可以理解为读取用户信息、角色及权限的 DAO，就是说SecurityManager要验证用户身份与权限，那么它需要从Realm获取相应的信息进行比较以确定用户身份是否合法；可以把Realm看成DataSource，即安全数据源。</p><h1 id="第一个Shiro应用"><a href="#第一个Shiro应用" class="headerlink" title="第一个Shiro应用"></a>第一个Shiro应用</h1><h2 id="配置依赖"><a href="#配置依赖" class="headerlink" title="配置依赖"></a>配置依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="添加shiro-realm-ini配置文件"><a href="#添加shiro-realm-ini配置文件" class="headerlink" title="添加shiro-realm.ini配置文件"></a>添加shiro-realm.ini配置文件</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定自定义realm的位置（在后面）</span></span><br><span class="line"><span class="attr">myRealm</span>= com.mani.MyRealm</span><br><span class="line"><span class="comment">#指定securityManager的realm实现</span></span><br><span class="line">securityManager.realms=$myRealm</span><br></pre></td></tr></table></figure><h2 id="创建SecurityManagerFactory"><a href="#创建SecurityManagerFactory" class="headerlink" title="创建SecurityManagerFactory"></a>创建SecurityManagerFactory</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载配置文件，创建工厂</span></span><br><span class="line">Factory&lt;SecurityManager&gt; factory = <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">"classpath:shiro.ini"</span>);</span><br></pre></td></tr></table></figure><p>这里以面向接口的方式来接收工厂对象</p><h2 id="通过工厂获取securityManager对象"><a href="#通过工厂获取securityManager对象" class="headerlink" title="通过工厂获取securityManager对象"></a>通过工厂获取securityManager对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">securityManager = factory.getInstance();</span><br></pre></td></tr></table></figure><h2 id="绑定securityManager"><a href="#绑定securityManager" class="headerlink" title="绑定securityManager"></a>绑定securityManager</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置到运行环境中</span></span><br><span class="line">SecurityUtils.setSecurityManager(securityManager);</span><br></pre></td></tr></table></figure><h2 id="创建Subject实例"><a href="#创建Subject实例" class="headerlink" title="创建Subject实例"></a>创建Subject实例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = SecurityUtils.getSubject();</span><br></pre></td></tr></table></figure><p>至此我们Shiro的核心Subject，SecurityManager和Realm都已经拥有了，这里我自定义一个Realm</p><h2 id="模拟用户登录认证操作"><a href="#模拟用户登录认证操作" class="headerlink" title="模拟用户登录认证操作"></a>模拟用户登录认证操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAuthenticate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    <span class="comment">// 判断当前用户未认证</span></span><br><span class="line">    <span class="keyword">if</span> (!subject.isAuthenticated()) &#123;</span><br><span class="line">        <span class="comment">// token中的参数相当于用户登录传入的账户和密码</span></span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"zhangsan"</span>, <span class="string">"666"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 登录</span></span><br><span class="line">            subject.login(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 输出认证信息：true或false</span></span><br><span class="line">        System.out.println(subject.isAuthenticated());</span><br><span class="line">        <span class="comment">// 登出</span></span><br><span class="line">        subject.logout();</span><br><span class="line">        System.out.println(subject.isAuthenticated());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义Realm"><a href="#自定义Realm" class="headerlink" title="自定义Realm"></a>自定义Realm</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"MyRealm"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取传入的用户名</span></span><br><span class="line">        String name = (String) token.getPrincipal();</span><br><span class="line">        <span class="comment">// 模拟数据库，真的用户名</span></span><br><span class="line">        String trueName = <span class="string">"zhangsan"</span>;</span><br><span class="line">        <span class="keyword">if</span> (!trueName.equals(name))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 数据库中的密码</span></span><br><span class="line">        String passWord = <span class="string">"666"</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// info对象表示realm登录比对信息</span></span><br><span class="line">        SimpleAuthenticationInfo info = <span class="keyword">new</span> SimpleAuthenticationInfo(name,passWord,getName());</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果：<img src="/dlh1234okok.github.io/2018/11/03/Shiro框架/1.jpg" alt=""></p><h2 id="认证解析"><a href="#认证解析" class="headerlink" title="认证解析"></a>认证解析</h2><p>​    在登录login方法处打上一个断点，进入方法-&gt;</p><p>​    <u>Subject subject = securityManager.login(this, token);</u></p><p>​    发现调用了SecurityManager的login方法，并将subject和token传入，再进入这个方法-&gt;</p><p><img src="/dlh1234okok.github.io/2018/11/03/Shiro框架/2.jpg" alt=""></p><p>​    进行认证操作-&gt;</p><p><img src="/dlh1234okok.github.io/2018/11/03/Shiro框架/3.jpg" alt=""></p><p>​    securityManger将认证操作托管给了一个认证器-&gt;</p><p><img src="/dlh1234okok.github.io/2018/11/03/Shiro框架/4.jpg" alt=""></p><p>​    在这里才真正开始认证-&gt;</p><p><img src="/dlh1234okok.github.io/2018/11/03/Shiro框架/5.jpg" alt=""></p><p><img src="/dlh1234okok.github.io/2018/11/03/Shiro框架/6.jpg" alt=""></p><p>​    从字面上的看出在这里它要获取AuthenticationInfo对象-&gt;</p><p><img src="/dlh1234okok.github.io/2018/11/03/Shiro框架/7.jpg" alt=""></p><p>​    不出意外跳到了我们的自定义realm中，将AuthenticationInfo返回-&gt;&gt;&gt;</p><p>​    基本上这一次认证就完成了</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;​    Apache Shiro是一个强大易用的&lt;strong&gt;Java安全框架&lt;/strong&gt;，提供了认证、授权、加密和会话管理功能，
      
    
    </summary>
    
      <category term="Shiro" scheme="http://www.dlhblog.online/categories/Shiro/"/>
    
    
  </entry>
  
  <entry>
    <title>Lucene了解和简单使用</title>
    <link href="http://www.dlhblog.online/2018/11/02/Lucene%E4%BA%86%E8%A7%A3%E5%92%8C%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <id>http://www.dlhblog.online/2018/11/02/Lucene了解和简单使用/</id>
    <published>2018-11-02T09:03:41.000Z</published>
    <updated>2018-11-03T00:58:53.721Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Lucene是什么"><a href="#Lucene是什么" class="headerlink" title="Lucene是什么"></a>Lucene是什么</h1><p>​    Lucene 是一个开放源代码的全文检索引擎工具包，但它不是一个完整的全文检索引擎，而是一个全文检索引擎的架构，提供了完整的查询引擎和索引引擎，部分文本分析引擎。 说到底它是一个信息检索程序库，而不是应用产品。 因此它并不像百度或者 google 那样，拿来就能用，它只是提供了一种工具让你能实现这些产品。</p><h1 id="Lucene-能做什么"><a href="#Lucene-能做什么" class="headerlink" title="Lucene 能做什么"></a>Lucene 能做什么</h1><p>​    要回答这个问题，先要了解 lucene 的本质。实际上 lucene 的功能很单一，说到底，就是我们给它若干个字符串，然后它为我们提供一个全文搜索服务， 最后告诉我们要搜索的关键词出现在哪里。知道了这个本质， 我们就可以发挥想象做任何符合这个条件的事情了。 比如我们可以把站内新闻都索引了，做个资料库；也可以把一个数据库表的若干个字段索引起来，那就不用再担心因为“%like%”而锁表了……</p><h1 id="深入Lucene"><a href="#深入Lucene" class="headerlink" title="深入Lucene"></a>深入Lucene</h1><h2 id="为什么-lucene-这么快"><a href="#为什么-lucene-这么快" class="headerlink" title="为什么 lucene 这么快"></a>为什么 lucene 这么快</h2><ul><li>倒排索引</li><li>压缩算法</li><li>二元搜索 </li></ul><h2 id="倒排序索引"><a href="#倒排序索引" class="headerlink" title="倒排序索引"></a>倒排序索引</h2><p>​    它是根据属性的值来查找记录。这种索引表中的每一项都包括一个属性值和具有该属性值的各记录的地址。由于不是由记录来确定属性值，而是由属性值来确定记录的位置，因而称为倒排索引(invertedindex)。 </p><p><img src="/dlh1234okok.github.io/2018/11/02/Lucene了解和简单使用/1.jpg" alt=""></p><h2 id="工作方式"><a href="#工作方式" class="headerlink" title="工作方式"></a>工作方式</h2><p>​    Lucene 提供的服务实际包含两部分：一入一出。所谓入是写入，即将你提供的源（本质是字符串）写入索引或者将其从索引中删除；所谓出是读出，即向用户提供全文搜索服务，让用户可以通过关键词定位源 </p><h2 id="写入流程"><a href="#写入流程" class="headerlink" title="写入流程"></a>写入流程</h2><ol><li>源字符串首先经过 analyzer 处理，包括：分词，分成一个个单词；去除 stopword（可选）。</li><li>将源中需要的信息加入 Document 的各个 Field（信息域） 中，并把需要索引的 Field 索引起来，把需要存储的 Field 存储起来。</li><li>将索引写入磁盘。 </li></ol><h2 id="读出流程"><a href="#读出流程" class="headerlink" title="读出流程"></a>读出流程</h2><ol><li>用户提供搜索关键词，经过 analyzer 处理。</li><li>对处理后的关键词搜索它的索引， 找出对应的 Document。</li><li>用户根据需要从找到的 Document 中提取需要的 Field。 </li></ol><h2 id="Docement"><a href="#Docement" class="headerlink" title="Docement"></a>Docement</h2><p>​    用户提供的源是一条条记录，它们可以是文本文件、字符串或者数据库表的一条记录等等。一条记录经过索引之后，就是以一个Document 的形式存储在索引文件中的。用户进行搜索，也是以Document 列表的形式返回。 </p><h2 id="Field"><a href="#Field" class="headerlink" title="Field"></a>Field</h2><p>​    一个 Document 可以包含多个信息域，例如一篇文章可以包含“标题”、“正文”、“最后修改时间”等信息域，这些信息域就是通过 Field在 Document 中存储的。Field 有两个属性可选：存储和索引。通过存储属性你可以控制是否对这个 Field 进行存储；通过索引属性你可以控制是否对该Field 进行索引。这看起来似乎有些废话，事实上对这两个属性的正确组合很重要。</p><h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>文本倒排处理 :</p><p><img src="/dlh1234okok.github.io/2018/11/02/Lucene了解和简单使用/2.jpg" alt=""></p><p>Lucene 整体使用如图所示： </p><p><img src="/dlh1234okok.github.io/2018/11/02/Lucene了解和简单使用/3.jpg" alt=""></p><h1 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h1><p>配置Lucene依赖或者项目导入jar包</p><h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">// 配置indexWriter</span></span><br><span class="line">IndexWriterConfig config = <span class="keyword">new</span> IndexWriterConfig(Version.LUCENE_4_9, analyzer);</span><br><span class="line"><span class="comment">// 指定索引写入时为CREATE_OR_APPEND模式</span></span><br><span class="line">config.setOpenMode(IndexWriterConfig.OpenMode.CREATE_OR_APPEND);</span><br><span class="line"><span class="comment">// 通过索引目录和配置信息，生成writer</span></span><br><span class="line">IndexWriter writer = <span class="keyword">new</span> IndexWriter(directory, config);</span><br><span class="line"><span class="comment">// 遍历读取文件目录dataDir里的所有文件</span></span><br><span class="line">Collection&lt;File&gt; files = FileUtils.listFiles(<span class="keyword">new</span> File(dataDir), TrueFileFilter.INSTANCE,</span><br><span class="line">TrueFileFilter.INSTANCE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line"><span class="comment">// 将一个文件的文件名和文件内容分别生成两个field信息域</span></span><br><span class="line">Field fileNameField = <span class="keyword">new</span> StringField(<span class="string">"fileName"</span>, file.getName(), Field.Store.YES);</span><br><span class="line">String context = FileUtils.readFileToString(file);</span><br><span class="line">Field contentField = <span class="keyword">new</span> TextField(<span class="string">"content"</span>, context, Field.Store.YES);</span><br><span class="line"><span class="comment">// 创建document，并添加两个信息域</span></span><br><span class="line">Document document = <span class="keyword">new</span> Document();</span><br><span class="line">document.add(fileNameField);</span><br><span class="line">document.add(contentField);</span><br><span class="line"><span class="comment">// 通过document通过writer写入到索引目录下</span></span><br><span class="line">writer.addDocument(document);</span><br><span class="line">&#125;</span><br><span class="line">writer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">search</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ParseException </span>&#123;</span><br><span class="line"><span class="comment">// 创建基础分词器</span></span><br><span class="line">Analyzer analyzer = <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_4_9);</span><br><span class="line">IndexReader indexReader = DirectoryReader.open(directory);</span><br><span class="line"><span class="comment">// 通过indexReader创建一个索引搜索器</span></span><br><span class="line">IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(indexReader);</span><br><span class="line"><span class="comment">// 创建一个分析器并指定需要搜索的信息域和分词器</span></span><br><span class="line">QueryParser queryParser = <span class="keyword">new</span> QueryParser(Version.LUCENE_4_9, <span class="string">"content"</span>, analyzer);</span><br><span class="line"><span class="comment">// 生成一个query</span></span><br><span class="line">Query query = queryParser.parse(<span class="string">"java"</span>);</span><br><span class="line"><span class="comment">// 开始搜索，指定返回结果数量</span></span><br><span class="line">TopDocs topDocs = searcher.search(query, <span class="number">10</span>);</span><br><span class="line">ScoreDoc[] scoreDocs = topDocs.scoreDocs;</span><br><span class="line">System.out.println(<span class="string">"命中数："</span> + topDocs.totalHits);</span><br><span class="line"><span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line"><span class="comment">// 取得document的id</span></span><br><span class="line"><span class="keyword">int</span> idDoc = scoreDoc.doc;</span><br><span class="line"><span class="comment">// 通过id获取document</span></span><br><span class="line">Document document = searcher.doc(idDoc);</span><br><span class="line">System.out.println(<span class="string">"分数："</span> + scoreDoc.score);</span><br><span class="line">System.out.println(<span class="string">"文件名："</span> + document.get(<span class="string">"fileName"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h1><h2 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a>分词器</h2><p>​    Lucene 自带的 StandardAnalyzer 分词器，只能对英语进行分词。在对中文进行分词的时候采用了一元分词，即每一个中文作为一个词，如“我是中国人”，则分词结果为“我”，“是”，“中”，“国”，“人”，可以看出分词效果很差。在这里推荐一个比较好用的中文分词器IKAnalyzer。 </p><h2 id="停用词"><a href="#停用词" class="headerlink" title="停用词"></a>停用词</h2><p>​    停用词是指在信息检索中，为节省存储空间和提高搜索效率，在处理自然语言数据（或文本）之前或之后会自动过滤掉某些字或词，这些字或词即被称为 Stop Words（停用词）。 比如中文中“了”，“么”，“呢”，“的”等意义不大且在一篇文章中出现频率又很高的词，又比如英文的”for”,”in”,”it”,”a”,”or”等词。在使用 IKAnalyzer 分词器的时候，可以在 IKAnalyzer.cfg.xml里配置相关信息，如下图： </p><p><img src="/dlh1234okok.github.io/2018/11/02/Lucene了解和简单使用/4.jpg" alt=""></p><h2 id="高亮-Highlighter"><a href="#高亮-Highlighter" class="headerlink" title="高亮-Highlighter"></a>高亮-Highlighter</h2><p><img src="/dlh1234okok.github.io/2018/11/02/Lucene了解和简单使用/5.jpg" alt=""></p><h1 id="Field属性详解"><a href="#Field属性详解" class="headerlink" title="Field属性详解"></a>Field属性详解</h1><p>​    Field 是文档中的域，包括 Field 名和 Field 值两部分，一个文档可以包括多个 Field， Document 只是 Field 的一个承载体， Field值即为要索引的内容，也是要搜索的内容。 </p><ul><li><p>是否分词(tokenized)</p><p>​    是：作分词处理，即将 Field 值进行分词，分词的目的是为了索引。比如：商品名称、商品简介等，这些内容用户要输入关键字搜索，由于搜索的内容格式大、内容多需要分词后将语汇单元索引。</p><p>​    否：不作分词处理，比如：商品 id、订单号、身份证号等</p></li><li><p>是否索引(indexed)</p><p>​    是：进行索引。将 Field 分词后的词或整个 Field 值进行索引，索引的目的是为了搜索。比如：商品名称、商品简介分词后进行索引，订单号、身份证号不用分词但也要索引，这些将来都要作为查询条件。</p><p>​    否：不索引。该域的内容无法搜索到，比如：商品 id、文件路径、图片路径等，不用作为查询条件的不用索引。</p></li><li><p>是否存储(stored)</p><p>​    是：将 Field 值存储在文档中，存储在文档中的 Field 才可以从Document 中获取。比如：商品名称、订单号，凡是将来要从 Document 中获取的 Field都要存储。</p><p>​    否：不存储 Field 值，不存储的 Field 无法通过 Document 获取，比如：商品简介，内容较大不用存储。如果要向用户展示商品简介可以从系统的关系数据库中获取商品简介。</p></li></ul><p>如果需要商品描述，则根据搜索出的商品 ID 去数据库中查询，然后显示出商品描述信息即可。 </p><h2 id="Field-常用类型"><a href="#Field-常用类型" class="headerlink" title="Field 常用类型"></a>Field 常用类型</h2><p>常用 的 Filed 类型，注意 Field 的属性，根据需求选择： </p><p><img src="/dlh1234okok.github.io/2018/11/02/Lucene了解和简单使用/6.jpg" alt=""></p><h2 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h2><ul><li><p>图书 id：</p><p>是否分词：不用分词，因为不会根据商品 id 来搜索商品</p><p>是否索引：不索引，因为不需要根据图书 ID 进行搜索</p><p>是否存储：要存储，因为查询结果页面需要使用 id 这个值</p></li><li><p>图书名称：</p><p>是否分词：要分词，因为要将图书的名称内容分词索引，根据关键搜索图书名称抽取的词。</p><p>是否索引：要索引。</p><p>是否存储：要存储</p></li><li><p>图书价格：</p><p>是否分词：要分词， lucene 对数字型的值只要有搜索需求的都要分词和索引，因为 lucene 对数字型的内容要特殊分词处理，本例子可能要根据价格范 围搜索，需要分词和索引。</p><p>是否索引：要索引</p><p>是否存储：要存储</p></li><li><p>图书图片地址：</p><p>是否分词：不分词</p><p>是否索引：不索引</p><p>是否存储：要存储</p></li><li><p>图书描述：</p><p>是否分词：要分词</p><p>是否索引：要索引</p><p>是否存储：因为图书描述内容量大，不在查询结果页面直接显示，不存储。 不存储是来不在 lucene 的索引文件中记录，节省 lucene的索引文件空间， 如果要在详情页面显示描述，思路： 从 lucene中取出图书的 id，根据图书的 id 查询关系数据库中 book 表得到描述信息。</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Lucene是什么&quot;&gt;&lt;a href=&quot;#Lucene是什么&quot; class=&quot;headerlink&quot; title=&quot;Lucene是什么&quot;&gt;&lt;/a&gt;Lucene是什么&lt;/h1&gt;&lt;p&gt;​    Lucene 是一个开放源代码的全文检索引擎工具包，但它不是一个完整的全文
      
    
    </summary>
    
      <category term="大数据" scheme="http://www.dlhblog.online/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
  </entry>
  
  <entry>
    <title>Hadoop-HDFS</title>
    <link href="http://www.dlhblog.online/2018/11/01/Hadoop-HDFS/"/>
    <id>http://www.dlhblog.online/2018/11/01/Hadoop-HDFS/</id>
    <published>2018-11-01T12:42:05.000Z</published>
    <updated>2018-11-02T09:06:32.732Z</updated>
    
    <content type="html"><![CDATA[<p>Hadoop 是分布式的系统架构，是 Apache 基金会顶级金牌项目 </p><h1 id="Hadoop组成"><a href="#Hadoop组成" class="headerlink" title="Hadoop组成"></a>Hadoop组成</h1><p><em>分布式存储系统 HDFS （ Hadoop Distributed File System ）</em></p><ul><li>分布式存储系统</li><li>提供了 高可靠性、高扩展性和高吞吐率的数据存储服务 </li></ul><p><em>分布式计算框架 MapReduce</em></p><ul><li>分布式计算框架（计算向数据移动）</li><li>具有 易于编程、高容错性和高扩展性等优点。 </li></ul><p><em>分布式资源管理框架 YARN（ Yet Another ResourceManagement）</em> </p><ul><li>负责集群资源的管理和调度 </li></ul><h1 id="分布式文件存储系统HDFS"><a href="#分布式文件存储系统HDFS" class="headerlink" title="分布式文件存储系统HDFS"></a>分布式文件存储系统HDFS</h1><p>​    分布式存储系统HDFS，主要解决大数据的存储问题。</p><h2 id="HDFS架构图"><a href="#HDFS架构图" class="headerlink" title="HDFS架构图"></a>HDFS架构图</h2><p><img src="/dlh1234okok.github.io/2018/11/01/Hadoop-HDFS/1.jpg" alt=""></p><h2 id="HDFS-数据存储单元（block）"><a href="#HDFS-数据存储单元（block）" class="headerlink" title="HDFS 数据存储单元（block）"></a>HDFS 数据存储单元（block）</h2><p><em>文件被切分成固定大小的数据块 block</em></p><ul><li>默认数据块大小为 128MB (hadoop2.x)，可自定义配置</li><li>若文件大小不到 128MB ，则单独存成一个 block</li></ul><p><em>一个文件存储方式</em></p><ul><li>按大小被切分成若干个 block ，存储到不同节点上</li><li>默认情况下每个 block 都有 3 个副本</li></ul><p>Block 大小和副本数通过 Client 端上传文件时设置，文件上传成功后副本数可以变更， Block Size 不可变更</p><p> <img src="/dlh1234okok.github.io/2018/11/01/Hadoop-HDFS/2.jpg" alt=""></p><p><strong>hdfs 存储模型：字节</strong></p><ul><li>文件线性切割成块（Block） :<strong>偏移量 offset</strong> （byte）</li><li>Block 分散存储在集群节点中</li><li>单一文件 Block 大小一致，文件与文件可以不一致</li><li>Block 可以设置副本数，副本分散在不同节点中，副本数不要超过节点数量</li><li>文件上传可以设置 Block 大小和副本数</li><li>已上传的文件 Block 副本数可以调整，大小不变</li><li>只支持一次写入多次读取，同一时刻只有一个写入者</li><li>可以 append 追加数据 </li></ul><h2 id="NameNode-（简称NN）"><a href="#NameNode-（简称NN）" class="headerlink" title="NameNode （简称NN）"></a>NameNode （简称NN）</h2><h3 id="NameNode-主要功能"><a href="#NameNode-主要功能" class="headerlink" title="NameNode 主要功能"></a>NameNode 主要功能</h3><ul><li>接受客户端的读/写服务</li><li>收集 DataNode 汇报的 Block 列表信息 </li></ul><h3 id="基于内存存储-：-不会和磁盘发生交换"><a href="#基于内存存储-：-不会和磁盘发生交换" class="headerlink" title="基于内存存储 ： 不会和磁盘发生交换"></a>基于内存存储 ： 不会和磁盘发生交换</h3><ul><li><strong>只存在内存中</strong></li><li><strong>持久化</strong> </li></ul><h3 id="NameNode-保存-metadata-信息"><a href="#NameNode-保存-metadata-信息" class="headerlink" title="NameNode 保存 metadata 信息"></a>NameNode 保存 metadata 信息</h3><ul><li>文件 owership(归属)和 permissions(权限)</li><li>文件大小，时间</li><li>（Block 列表： Block 偏移量），位置信息</li><li>Block 保存在哪个 DataNode 信息（由 DataNode 启动时上报,不保存在磁盘） </li></ul><h3 id="NameNode-持久化"><a href="#NameNode-持久化" class="headerlink" title="NameNode 持久化"></a>NameNode 持久化</h3><ul><li><strong>NameNode</strong> 的 metadate 信息在启动后会加载到内存</li><li><strong>metadata</strong> 存储到磁盘文件名为”<strong>fsimage</strong>”</li><li><strong>Block</strong> 的位置信息不会保存到 <strong>fsimage</strong></li><li><strong>edits</strong> 记录对 <strong>metadata</strong> 的操作日志 </li></ul><p><strong>fsimage</strong> 保存了最新的元数据检查点,类似快照。</p><ul><li><p><strong>editslog</strong> 保存自最新检查点后的元信息变化， 从最新检查点后， hadoop 将对每个文件的操作都保存在edits 中。 客户端修改文件时候，先写到 editlog，成功后才更新内存中的metadata 信息。</p><p><strong>Metadata = fsimage + editslog</strong> </p></li></ul><h2 id="DataNode（DN）"><a href="#DataNode（DN）" class="headerlink" title="DataNode（DN）"></a>DataNode（DN）</h2><ul><li>本地磁盘目录存储数据（Block），文件形式</li><li>同时存储 Block 的元数据信息文件</li><li>启动 DN 进程的时候会向 NameNode 汇报 block 信息</li><li>通过向 NN 发送心跳保持与其联系（3 秒一次），如果 NN 10分钟没有收到 DN 的心跳，则认为其已经lost，并 copy 其上的 block 到其它 DN </li></ul><h2 id="SecondaryNameNode（SNN）"><a href="#SecondaryNameNode（SNN）" class="headerlink" title="SecondaryNameNode（SNN）"></a>SecondaryNameNode（SNN）</h2><p>​    <u>它的主要工作是帮助 NN 合并 edits log 文件，减少 NN 启动时间,它不是 NN 的备份（但可以做备份)。</u></p><p>SNN 执行合并时间和机制</p><ol><li>根据配置文件设置的时间间隔 fs.checkpoint.period 默认 3600 秒。</li><li>根据配置文件设置 edits log 大小 fs.checkpoint.size规定 edits 文件的最大值默认是 64MB </li></ol><h2 id="SecondaryNameNode-SNN-合并流程"><a href="#SecondaryNameNode-SNN-合并流程" class="headerlink" title="SecondaryNameNode SNN 合并流程"></a>SecondaryNameNode SNN 合并流程</h2><p><img src="/dlh1234okok.github.io/2018/11/01/Hadoop-HDFS/3.jpg" alt=""></p><p>​    首先是 NN 中的 Fsimage 和 edits 文件通过网络拷贝，到达SNN 服务器中，拷贝的同时，用户的实时在操作数据，那么 NN中就会从新生成一个 edits 来记录用户的操作，而另一边的 SＮＮ将拷贝过来的 edits 和 fsimage 进行合并，合并之后就替换NN 中的 fsimage。之后 NN 根据 fsimage 进行操作（当然每隔一段时间就进行替换合并，循环）。当然新的 edits 与合并之后传输过来的 fsimage 会在下一次时间内又进行合并。 </p><h2 id="Block-的副本放置策略"><a href="#Block-的副本放置策略" class="headerlink" title="Block 的副本放置策略"></a>Block 的副本放置策略</h2><ul><li>第一个副本：放置在上传文件的 DN；如果是集群外提交，则随机挑选一台磁盘不太满， CPU 不太忙的节点。</li><li>第二个副本：放置在于第一个副本不同的机架的节点上。</li><li>第三个副本：与第二个副本相同机架的不同节点。</li><li>更多副本：随机节点 </li></ul><h2 id="HDFS-读写流程"><a href="#HDFS-读写流程" class="headerlink" title="HDFS 读写流程"></a>HDFS 读写流程</h2><p><img src="/dlh1234okok.github.io/2018/11/01/Hadoop-HDFS/4.jpg" alt=""></p><h3 id="HDFS-写流程"><a href="#HDFS-写流程" class="headerlink" title="HDFS 写流程"></a>HDFS 写流程</h3><p>Client：</p><ol><li><p>切分文件 Block</p></li><li><p>按 Block 线性和 NN 获取 DN 列表（副本数）</p></li><li><p>验证 DN 列表后以更小的单位(packet)流式传输数据</p><p>​    各节点，两两通信确定可用</p></li><li><p>Block 传输结束后：</p><p>​    DN 向 NN 汇报 Block 信息</p><p>​    DN 向 Client 汇报完成</p><p>​    Client 向 NN 汇报完成</p></li><li><p>获取下一个 Block 存放的 DN 列表</p></li><li><p>……………..</p></li><li><p>最终 Client 汇报完成</p></li><li><p>NN 会在写流程更新文件状态 </p></li></ol><h3 id="读文件过程"><a href="#读文件过程" class="headerlink" title="读文件过程"></a>读文件过程</h3><p><img src="/dlh1234okok.github.io/2018/11/01/Hadoop-HDFS/5.jpg" alt=""></p><p>Client：</p><ol><li>和 NN 获取一部分 Block 副本位置列表</li><li>线性和 DN 获取 Block，最终合并为一个文件</li><li>在 Block 副本列表中按距离择优选取 </li></ol><h2 id="HDFS-的优缺点"><a href="#HDFS-的优缺点" class="headerlink" title="HDFS 的优缺点"></a>HDFS 的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li><p>高容错性</p><p>数据自动保存多个副本</p><p>副本丢失后，自动恢复</p></li><li><p>适合批处理</p><p>移动计算而非数据</p><p>数据位置暴露给计算框架（Block 偏移量）</p></li><li><p>适合大数据处理</p><p>GB 、 TB 、甚至 PB 级数据</p><p>百万规模以上的文件数量</p><p>10K+ 节点</p></li><li><p>可构建在廉价机器上</p><p>通过多副本提高可靠性</p><p>提供了容错和恢复机制 </p></li></ul><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul><li>低延迟高数据吞吐访问问题<br>比如支持秒级别反应，不支持毫秒级<br>延迟与高吞吐率问题（吞吐量大但有限制于其延迟）</li><li>小文件存取<br>占用 NameNode 大量内存<br>寻道时间超过读取时间</li><li>并发写入、文件随机修改<br>一个文件只能有一个写者<br>仅支持 append </li></ul><h1 id="Hadoop伪分布式搭建"><a href="#Hadoop伪分布式搭建" class="headerlink" title="Hadoop伪分布式搭建"></a>Hadoop伪分布式搭建</h1><ol><li><p>jdk 安装，配置环境变量</p><p>vi /etc/profile</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/dlh/jdk1.7.0_75</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin</span><br></pre></td></tr></table></figure></li><li><p>ssh 免密钥（本机）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa -P &apos;&apos; -f ~/.ssh/id_dsa</span><br><span class="line">cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></li><li><p>上传 hadoop.tar.gz 到服务器</p><p>解压部署包 到/opt/dlh 目录下</p><p>vi /etc/profile</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_PREFIX=/opt/dlh/hadoop-2.6.5</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin:$HADOOP_PREFIX/bin:$HADOOP_PREFIX/sbin</span><br></pre></td></tr></table></figure></li><li><p>/opt/dlh/hadoop-2.6.5/etc/hadoop 目录</p><p>hadoop-env.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/opt/dlh/jdk1.7.0_75</span><br></pre></td></tr></table></figure><p>core-site.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">&lt;value&gt;hdfs://192.168.32.222:9000&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">&lt;value&gt;/var/dlh/hadoop/local&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure><p>hdfs-site.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">&lt;value&gt;1&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;</span><br><span class="line">&lt;value&gt;192.168.32.222:50090&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure><p>vi slaves（datanode 节点）<br>192.168.32.222</p></li><li><p>格式化 hdfs namenode -format</p></li><li><p>启动 start-dfs.sh</p></li><li><p>查看服务进程启动了么？ jps<br>SecondaryNameNode<br>NameNode<br>DataNode<br>Jps</p></li><li><p>访问 192.168.32.222:50070<br>确保防火墙关闭（service iptables stop）</p></li><li><p>hdfs dfs -mkdir /user</p></li><li><p>hdfs dfs -ls /user</p></li><li><p>hdfs dfs 命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -put fileName[本地文件名] PATH【hdfs 的文件路径】</span><br><span class="line">hdfs dfs -du [-s][-h]URI[URI ...] 显示文件(夹)大小.</span><br><span class="line">hdfs dfs -mkdir[-p] &lt;paths&gt; 创建</span><br><span class="line">hdfs dfs -rm -r /myhadoop1.0 删除</span><br><span class="line">hdfs dfs -cp [-f][-p|-p[topax]]URI[URI...]&lt;dest&gt;复制文件(夹)，可以覆盖，可以保留原有权限信息</span><br></pre></td></tr></table></figure></li><li><p>产生 100000 条数据测试：<br>for i in <code>seq 100000</code>;do echo “hello hadoop$i” &gt;&gt; test.txt;done </p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Hadoop 是分布式的系统架构，是 Apache 基金会顶级金牌项目 &lt;/p&gt;
&lt;h1 id=&quot;Hadoop组成&quot;&gt;&lt;a href=&quot;#Hadoop组成&quot; class=&quot;headerlink&quot; title=&quot;Hadoop组成&quot;&gt;&lt;/a&gt;Hadoop组成&lt;/h1&gt;&lt;p&gt;&lt;e
      
    
    </summary>
    
      <category term="大数据" scheme="http://www.dlhblog.online/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
  </entry>
  
  <entry>
    <title>Nginx配置</title>
    <link href="http://www.dlhblog.online/2018/10/30/Nginx%E9%85%8D%E7%BD%AE/"/>
    <id>http://www.dlhblog.online/2018/10/30/Nginx配置/</id>
    <published>2018-10-30T11:34:31.000Z</published>
    <updated>2018-11-03T05:12:09.065Z</updated>
    
    <content type="html"><![CDATA[<h1 id="什么是-Nginx？"><a href="#什么是-Nginx？" class="headerlink" title="什么是 Nginx？"></a>什么是 Nginx？</h1><ul><li>​    Nginx 是一款轻量级的 Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器。由俄罗斯的程序设计师Igor Sysoev 所开发，其特点是占有内存少， 并发能力强， nginx 的并发能力确实在同类型的网页服务器中表现非常好。</li><li>​    2004 年 10 月 4 日 第一个公开版本 0.1.0 发布。其将源代码以类 BSD 许可证的形式发布。</li><li>​    官方测试 nginx 能够支撑 5 万并发链接，并且 CPU、内存等资源消耗却非常低，运行非常稳定 。</li></ul><h1 id="Nginx-和-apache-的优缺点"><a href="#Nginx-和-apache-的优缺点" class="headerlink" title="Nginx 和 apache 的优缺点"></a>Nginx 和 apache 的优缺点</h1><ol><li><p>nginx 相对于 apache 的优点：</p><p>​    轻量级，同样起 web 服务，比 apache 占用更少的内存及资源高并发，nginx 处理请求是<strong>异步非阻塞</strong>（如前端 ajax） 的，而 apache 则是阻塞型的，在高并发下 nginx 能保持<strong>低资源低消耗高性能高度模块化的设计</strong>，编写模块相对简单还有，它社区活跃，各种高性能模块出品迅速（十几年时间发展）</p></li><li><p>apache 相对于 nginx 的优点：</p><p>​    Rewrite 重写 ，比 nginx 的 rewrite 强大模块超多，基本想到的都可以找到少 bug ， nginx 的 bug 相对较多。（出身好起步高）</p></li><li><p>Nginx 配置简洁, Apache 复杂</p></li></ol><h1 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h1><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>依赖 gcc openssl-devel pcre-devel zlib-devel<br>安装： yum -y install gcc openssl-devel pcre-devel zlib-devel</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/nginx1.jpg" alt=""></p><h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><p>解压： tar -zxvf nginx-1.8.1.tar.gz</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/nginx2.jpg" alt=""></p><h2 id="configure-配置"><a href="#configure-配置" class="headerlink" title="configure 配置"></a>configure 配置</h2><p>进入解压后的源码目录，然后执行 configure 命令进行配置<br>./configure –prefix=/usr/soft/nginx (设置编译后的文件目录)</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/nginx3.jpg" alt=""></p><h2 id="编译并安装"><a href="#编译并安装" class="headerlink" title="编译并安装"></a>编译并安装</h2><p>make &amp;&amp; make install</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/nginx4.jpg" alt=""></p><p>安装好后，会在/usr/soft 下生成 nginx 目录(这是我编译前指定的)，<br>这个目录就是 nginx 的软件了。</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/nginx5.jpg" alt=""></p><h1 id="nginx-命令"><a href="#nginx-命令" class="headerlink" title="nginx 命令"></a>nginx 命令</h1><p>启动命令 ： nginx_home/sbin/nginx</p><p>启动后，访问虚拟机的 80 端口，可查看到以下界面</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/nginx6.jpg" alt=""></p><p>Nginx 默认监听 80 端口，当出现以上信息，说明安装启动成功</p><p>一旦 nginx 启动，就可以通过调用带有-s 参数的可执行文件来控制它。<br>使用语法： nginx -s 信号</p><p>信号可以是下列之一：<br>​    stop - 快速关机<br>​    quit - 优雅的关机<br>​    reload - 重新加载配置文件<br>​    reopen - 重新打开日志文件<br>例如，要停止 nginx 进程并等待工作进程完成当前请求的服务，可以执<br>行以下命令： nginx -s quit</p><h1 id="Nginx-配置"><a href="#Nginx-配置" class="headerlink" title="Nginx 配置"></a>Nginx 配置</h1><h2 id="nginx-默认配置详解"><a href="#nginx-默认配置详解" class="headerlink" title="nginx 默认配置详解"></a>nginx 默认配置详解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#进程数，建议设置和 CPU 个数一样或 2 倍</span><br><span class="line">worker_processes 2;</span><br><span class="line"></span><br><span class="line">#日志级别</span><br><span class="line">error_log logs/error.log warning;(默认 error 级别)</span><br><span class="line"></span><br><span class="line">nginx 启动后的 pid 存放位置</span><br><span class="line"></span><br><span class="line">#pid logs/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">#配置每个进程的连接数，总的连接数= worker_processes * worker_connections</span><br><span class="line">#根据物理内存大小来配置，默认 1024</span><br><span class="line">worker_connections 10240;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">include mime.types;</span><br><span class="line">default_type application/octet-stream;</span><br><span class="line">sendfile on;</span><br><span class="line">#连接超时时间，单位秒</span><br><span class="line">keepalive_timeout 65;</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name localhost</span><br><span class="line">#默认请求</span><br><span class="line">location / &#123;</span><br><span class="line">root html; #定义服务器的默认网站根目录位置</span><br><span class="line">index index.php index.html index.htm; #定义首页索引文件的名称</span><br><span class="line">&#125;</span><br><span class="line">#定义错误提示页面</span><br><span class="line">error_page 500 502 503 504 /50x.html;</span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">root html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="负载均衡配置："><a href="#负载均衡配置：" class="headerlink" title="负载均衡配置："></a>负载均衡配置：</h2><p>nginx 支持以下负载均衡机制（或方法）：</p><ul><li>循环 - 对应用程序服务器的请求以循环方式分发，</li><li>最少连接数 - 将下一个请求分配给活动连接数最少的服务器</li><li>ip-hash - 哈希函数用于确定下一个请求（基于客户端的 IP地址）应该选择哪个服务器。</li></ul><h2 id="默认负载平衡配置"><a href="#默认负载平衡配置" class="headerlink" title="默认负载平衡配置"></a>默认负载平衡配置</h2><p>使用 nginx 进行负载平衡的最简单配置可能如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">upstream frame&#123;</span><br><span class="line">server srv1.example.com;</span><br><span class="line">server srv2.example.com;</span><br><span class="line">server srv3.example.com;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name localhost;</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://frame;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​      在上面的示例中，在 srv1-srv3 上运行相同应用程序的 3 个实例。如果没有专门配置负载均衡方法，则默认为循环法。所有请求都被 代理到服务器组 ss，并且 nginx 应用 HTTP 负载平衡来分发请求。</p><h2 id="加权负载平衡"><a href="#加权负载平衡" class="headerlink" title="加权负载平衡"></a>加权负载平衡</h2><p>   通过使用服务器权重，还可以进一步影响nginx负载均衡算法，谁的权重越大，分发到<br>的请求就越多。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream frame &#123;</span><br><span class="line">  server srv1.example.com weight=3;</span><br><span class="line">  server srv2.example.com;</span><br><span class="line">  server srv3.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="最少连接负载平衡"><a href="#最少连接负载平衡" class="headerlink" title="最少连接负载平衡"></a>最少连接负载平衡</h2><p>在连接负载最少的情况下， nginx 会尽量避免将过多的请求分发给繁忙的应用程序服务器，而是将新请求分发给不太繁忙的服务器，避免服务器过载。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream frame &#123;</span><br><span class="line">  least_conn;</span><br><span class="line">  server srv1.example.com;</span><br><span class="line">  server srv2.example.com;</span><br><span class="line">  server srv3.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="会话持久性"><a href="#会话持久性" class="headerlink" title="会话持久性"></a>会话持久性</h2><p>上述的循环或最少连接数的负载平衡方法，每个后续客户端的请求都可能被分发到不同的服务器。不能保证相同的客户端总是定向到相同的服务器。如果需要将客户端绑定到特定的应用程序服务器 - 换句话说，就是始终选择相同的服务器而言， 就要使客户端的会话“粘滞”或“持久” 。</p><p><strong>ip-hash</strong> 负载平衡机制就是有这种特性。 使用 ip-hash，客户端的 IP 地址将用作散列键，以确定应该为客户端的请求选择服务器组中的哪台服务器。 此方法可确保来自同一客户端的请求将始终定向到同一台服务器，除非此服务器不可用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream frame&#123;</span><br><span class="line">  ip_hash;</span><br><span class="line">  server srv1.example.com;</span><br><span class="line">  server srv2.example.com;</span><br><span class="line">  server srv3.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Nginx访问控制"><a href="#Nginx访问控制" class="headerlink" title="Nginx访问控制"></a>Nginx访问控制</h2><p>Nginx 还可以对 IP 的访问进行控制， allow 代表允许， deny 代表禁止<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">  deny 192.168.78.1;</span><br><span class="line">  allow 192.168.78.0/24;</span><br><span class="line">  allow 10.1.1.0/16;</span><br><span class="line">  allow 192.168.1.0/32;</span><br><span class="line">  deny all;</span><br><span class="line">  proxy_pass http://frame;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>从上到下的顺序，匹配到了便跳出。如上的例子先禁止了 192.168.78.1，接下来允许了 3 个网段，其中包含了一个 ipv6，最后未匹配的 IP 全部禁止访问</p><h1 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h1><h2 id="何为虚拟主机"><a href="#何为虚拟主机" class="headerlink" title="何为虚拟主机"></a>何为虚拟主机</h2><p>​    虚拟主机是指在网络服务器上分出一定的磁盘空间，用户可以租用此部分空间，以供用户放置站点及应用组件，提供必要的数据存放和传输功能。</p><p>​    说白了虚拟主机就是把一台物理服务器划分成多个“虚拟”的服务器，各个虚拟主机之间完全独立，在外界看来，每一台虚拟主机和一台单独的主机的表现完全相同。所以这种被虚拟化的逻辑主机被形象地称为“虚拟主机”。</p><p><strong>优点：</strong></p><p>​    由于多台虚拟主机共享一台真实主机的资源，每个虚拟主机用户承受的硬件费用、网络维护费用、通信线路的费用均大幅度降低。许多企业建立网站都采用这种方法，这样不仅大大节省了购买机器和租用专线的费用， 网站服务器服务器管理简单，诸如软件配置、防病毒、防攻击等安全措施都由专业服务商提供，大大简化了服务器管理的复杂性；同时也不必为使用和维护服务器的技术问题担心，更不必聘用专门的管理人员。</p><p><strong>类别：</strong></p><p>1、基于域名的虚拟主机，通过域名来区分虚拟主机</p><p>2、基于端口的虚拟主机，通过端口来区分虚拟主机</p><p>3、基于 ip 的虚拟主机， 很少用</p><h2 id="基于域名的虚拟主机"><a href="#基于域名的虚拟主机" class="headerlink" title="基于域名的虚拟主机"></a>基于域名的虚拟主机</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream frame1&#123;</span><br><span class="line">      server srv1.example.com;</span><br><span class="line">      server srv2.example.com;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream frame2&#123;</span><br><span class="line">      server srv3.example.com;</span><br><span class="line">      server srv4.example.com;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">      listen <span class="number">80</span>;</span><br><span class="line">      <span class="comment">//访问 xt1.com 的时候，会把请求导到 frame1 的服务器组里</span></span><br><span class="line">      server_name xt1.com;</span><br><span class="line">      location / &#123;</span><br><span class="line">        proxy_pass http:<span class="comment">//frame1;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">      listen <span class="number">80</span>;</span><br><span class="line">      <span class="comment">//访问 xt2.com 的时候，会把请求导到 frame2 的服务器组里</span></span><br><span class="line">      server_name xt2.com;</span><br><span class="line">      location / &#123;</span><br><span class="line">        proxy_pass http:<span class="comment">//frame2;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：</strong></p><p>基于域名的虚拟机主机 在模拟应用场景时，需要在 windows 系统的 hosts文件里配置域名映射。 （C:\Windows\System32\drivers\etc\hosts）</p><p><img src="/dlh1234okok.github.io/2018/10/30/Nginx配置/1.jpg" alt=""></p><h2 id="基于端口的虚拟主机"><a href="#基于端口的虚拟主机" class="headerlink" title="基于端口的虚拟主机"></a>基于端口的虚拟主机</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  upstream frame1&#123;</span><br><span class="line">    server srv1.example.com;</span><br><span class="line">    server srv2.example.com;</span><br><span class="line">  &#125;</span><br><span class="line">  upstream frame2&#123;</span><br><span class="line">    server srv3.example.com;</span><br><span class="line">    server srv4.example.com;</span><br><span class="line">  &#125;</span><br><span class="line">  server &#123;</span><br><span class="line">    <span class="comment">//当访问 nginx 的 80 端口时，将请求导给 frame1 组</span></span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    location / &#123;</span><br><span class="line">      proxy_pass http:<span class="comment">//frame1;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  server &#123;</span><br><span class="line">    <span class="comment">//当访问 nginx 的 81 端口时，将请求导给 frame2 组</span></span><br><span class="line">    listen <span class="number">81</span>;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    location / &#123;</span><br><span class="line">      proxy_pass http:<span class="comment">//frame2;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="正向代理和反向代理"><a href="#正向代理和反向代理" class="headerlink" title="正向代理和反向代理"></a>正向代理和反向代理</h1><h2 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h2><p>​    举个栗子： 我是一个用户，我访问不了某网站，但是我能访问一个代理服务器，这个代理服务器呢,他能访问那个我不能访问的网站，于是我先连上代理服务器,告诉他我需要那个无法访问网站的内容，代理服务器去取回来,然后返回给我。 像我们经常通过 vpn 访问国外的网站，此时就是正向代理。</p><ul><li>客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的 IP 地址，还有代理程序的端口。</li></ul><h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>​    <strong>反向代理（Reverse Proxy）</strong> 方式是指以代理服务器来接受 internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器</p><p>​    反向代理隐藏了真实的服务端，当我们请求 <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> 的时候，就像拨打 10086 一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了， <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。 Nginx 就是性能非常好的反向代理服务器，用来做负载均衡。     </p><h1 id="Nginx-的-session-的一致性问题"><a href="#Nginx-的-session-的一致性问题" class="headerlink" title="Nginx 的 session 的一致性问题"></a>Nginx 的 session 的一致性问题</h1><p>​    http 协议是无状态的，即你连续访问某个网页 100 次和访问 1次对服务器来说是没有区别对待的，因为它记不住你。那么，在一些场合，确实需要服务器记住当前用户怎么办？比如用户登录邮箱后，接下来要收邮件、写邮件，总不能每次操作都让用户输入用户名和密码吧，为了解决这个问题， session 的方案就被提了出来，事实上它并不是什么新技术，而且也不能脱离 http 协议以及任何现有的 web 技术session 的常见实现形式是会话cookie（session cookie），即未设置过期时间的 cookie，这个 cookie 的默认生命周期为浏览器会话期间，只要关闭浏览器窗口， cookie 就消失了。</p><h2 id="Session-共享"><a href="#Session-共享" class="headerlink" title="Session 共享"></a>Session 共享</h2><p>​    首先我们应该明白，为什么要实现共享，如果你的网站是存放在一个机器上，那么是不存在这个问题的，因为会话数据就在这台机器，但是如果你使用了负载均衡把请求分发到不同的机器呢？这个时候会话 id 在客户端是没有问题的，但是如果用户的两次请求到了两台不同的机器，而它的 session 数据可能存在其中一台机器，这个时候就会出现取不到 session 数据的情况，于是 session 的共享就成了一个问题 。</p><h2 id="Session-一致性解决方案"><a href="#Session-一致性解决方案" class="headerlink" title="Session 一致性解决方案"></a>Session 一致性解决方案</h2><ol><li><p>session 复制</p><p>tomcat 本身带有复制 session 的功能。</p></li><li><p>共享 session</p><p>需要专门管理 session 的软件，</p></li><li><p>memcached 缓存服务，可以和 tomcat 整合，帮助 tomcat共享管理 session。</p></li></ol><h2 id="安装-memcached"><a href="#安装-memcached" class="headerlink" title="安装 memcached"></a>安装 memcached</h2><ol><li><p>安装 memcached 内存数据库<br> yum – y install memcached<br> 可以用 telnet localhost 11211</p></li><li><p>web 服务器连接 memcached 的 jar 包拷贝到 tomcat 的 lib</p></li><li><p>配置 tomcat 的 conf 目录下的 context.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"de.javakaffee.web.msm.MemcachedBackupSessionManager"</span></span></span><br><span class="line"><span class="tag"><span class="attr">memcachedNodes</span>=<span class="string">"n1:192.168.17.9:11211"</span></span></span><br><span class="line"><span class="tag"><span class="attr">sticky</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag"><span class="attr">lockingMode</span>=<span class="string">"auto"</span></span></span><br><span class="line"><span class="tag"><span class="attr">sessionBackupAsync</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag"><span class="attr">requestUriIgnorePattern</span>=<span class="string">".*\.(ico|png|gif|jpg|css|js)$"</span></span></span><br><span class="line"><span class="tag"><span class="attr">sessionBackupTimeout</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag"><span class="attr">transcoderFactoryClass</span>=<span class="string">"de.javakaffee.web.msm.serializer.kr</span></span></span><br><span class="line"><span class="tag"><span class="string">yo.KryoTranscoderFactory"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>​    配置 memcachedNodes 属性，配置 memcached 数据库的 ip 和端口，默认 11211，多个的话用逗号隔开。<br>​    目的是让 tomcat 服务器从 memcached 缓存里面拿 session 或者是放 session</p></li><li><p>修改 index.jsp，取 sessionid 看一看</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html;charset=UTF-8"</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">   SessionID:<span class="tag">&lt;<span class="name">%=session.getId()%</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">   SessionIP:<span class="tag">&lt;<span class="name">%=request.getServerName()%</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>tomcat1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;什么是-Nginx？&quot;&gt;&lt;a href=&quot;#什么是-Nginx？&quot; class=&quot;headerlink&quot; title=&quot;什么是 Nginx？&quot;&gt;&lt;/a&gt;什么是 Nginx？&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;​    Nginx 是一款轻量级的 Web 服务器/反向代理服
      
    
    </summary>
    
      <category term="大数据" scheme="http://www.dlhblog.online/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
  </entry>
  
  <entry>
    <title>Linux常用命令</title>
    <link href="http://www.dlhblog.online/2018/10/29/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>http://www.dlhblog.online/2018/10/29/Linux常用命令/</id>
    <published>2018-10-29T11:18:14.000Z</published>
    <updated>2018-10-30T08:56:00.347Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Linux目录结构"><a href="#Linux目录结构" class="headerlink" title="Linux目录结构"></a>Linux目录结构</h1><p><img src="http://pg0l2q23d.bkt.clouddn.com/l1.jpg" alt=""></p><ul><li>bin  存放二进制可执行文件(ls,cat,mkdir等)                                                           </li><li>boot  存放用于系统引导时使用的各种文件</li><li>dev 用于存放设备文件</li><li>etc  存放系统配置文件</li><li>home 存放所有用户文件的根目录</li><li>lib  存放跟文件系统中的程序运行所需要的共享库及内核模块</li><li>mnt  系统管理员安装临时文件系统的安装点</li><li>opt  额外安装的可选应用程序包所放置的位置</li><li>proc  虚拟文件系统，存放当前内存的映射</li><li>root  超级用户目录</li><li>sbin  存放二进制可执行文件，只有root才能访问</li><li>tmp  用于存放各种临时文件</li><li>usr  用于存放系统应用程序，比较重要的目录/usr/local 本地管理员软件安装目录</li><li>var  用于存放运行时需要改变数据的文件</li></ul><h1 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h1><p>切换目录：cd + 目录路径</p><p>查看当前目录完整路径： pwd</p><p>返回父目录：    cd ..</p><p>新建目录：    <strong>mkdir</strong>+目录名</p><hr><p>查看当前目录下拥有的子目录和文件： <strong>ls</strong></p><p>查看当前目录下拥有的子目录和文件的详情信息：ls -l 或 <strong>ll</strong></p><p>拷贝目录：    <strong>cp</strong>  source  dest -r（递归）</p><hr><p>删除目录：    <strong>rmdir</strong> directory（只能删除空目录）</p><p>删除非空目录或文件：    <strong>rm</strong>    -rf    dir</p><hr><p>移动文件或目录：<strong>mv</strong> + 目录/文件名字 + 其他路径</p><p>更改文件或目录的名字：<strong>mv</strong> + 旧目录名字 + 新目录名字</p><h1 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h1><p>创建一个空文件：    <strong>touch</strong>   文件名</p><p>复制文件：    <strong>cp</strong>     文件名    复制的文件名</p><p>复制目录：    复制文件，加个-r 参数，代表遍历复制</p><hr><p>删除文件：    <strong>rm</strong>   文件名（加 –f参数，直接删除，无需确认）</p><p>删除目录：    删除文件加上-r参数，遍历删除</p><hr><p>查看目录：ls/ll    ls -l == ll</p><p>查看目录下所有东西（包括隐藏文件）：    ls  -al  （ll -a）</p><hr><p>查看文件内容：<strong>cat</strong>  filename（一次显示文件所有内容），当文件较大时，可以使用<strong>more</strong>  或  <strong>less</strong></p><p>​    <strong>more</strong> filename 该命令一次显示一屏文本，满屏后停下来，并且在屏幕的底部出现一个提示信息，给出至今己显示的该文件的百分比。</p><ol><li>按Space键，显示文本的下一屏内容。</li><li>按Enier键，只显示文本的下一行内容。</li><li>按B键，显示上一屏内容。</li><li>按Q键，退出。</li></ol><p>​    <strong>less</strong>命令 与 more命令 非常类似        <strong>less</strong> filename:</p><ol><li>h 显示帮助界面 </li><li>Q 退出less 命令 </li><li>u 向后滚动半页 </li><li>d 向前翻半页 </li><li>空格键 滚动一页 </li><li>b 向后翻一页 </li><li>回车键 滚动一行</li><li>[pagedown]： 向下翻动一页 </li><li>[pageup]： 向上翻动一页</li><li>上下键，向上一行，向下一行</li></ol><hr><p>从头打印文件内容：    <strong>head</strong>  -10 filename     打印文件1到10行</p><p>从尾部打印文件内容：    <strong>tail</strong> -10 filename         打印文件最后10行</p><p><strong>注意</strong>：tail 还经常可以拿来查看文件的内容变化    加-f参数，<strong>tail</strong> –f filename</p><p>查找文件或目录：    <strong>find</strong>  pathname –name filename（可以按正则表达式来查找）</p><h1 id="文本编辑"><a href="#文本编辑" class="headerlink" title="文本编辑"></a>文本编辑</h1><p><strong>编辑模式</strong></p><ul><li>vi  filename :打开或新建文件，并将光标置于第一行首 </li><li>vi +n filename ：打开文件，并将光标置于第n行首 </li><li>vi + filename ：打开文件，并将光标置于最后一行首 </li><li>vi +/pattern filename：打开文件，并将光标置于第一个与 pattern匹配的串处 </li></ul><p><strong>命令行模式</strong></p><ul><li>w保存 </li><li>q退出 </li><li>q!：不保存文件并退出vi </li><li>在VI的命令模式下输入“:set nu”，就有行号了。 </li><li>在VI的命令模式下输入“:set nonu”，取消行号。 </li></ul><p><strong>一般模式</strong></p><ul><li>yy 复制光标所在行(常用) </li><li>nyy 复制光标所在行的向下n行，例如， 20yy则是复制20行(常用) </li><li>p,P   p为复制的数据粘贴在光标下一行， P则为粘贴在光标上一行(常用)</li><li>G:光标移至第最后一行</li><li>nG：光标移动至第N行行首</li><li>n+：光标下移n行 </li><li>n-：光标上移n行 </li><li>H ：光标移至屏幕顶行 </li><li>M ：光标移至屏幕中间行 </li><li>L ：光标移至屏幕最后行 </li><li>dd：删除 行 </li><li>x或X：删除一个字符，x删除光标后的，而X删除光标前的 </li><li>u 恢复前一个动作(常用)</li><li>删除第N行到第M行 :  N,Md</li></ul><h1 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h1><p><strong>将本地文件复制到远程机器</strong></p><p><strong>scp</strong> local_file    remote_username@remote_ip:remote_folder </p><p><strong>将本地目录复制到远程机器</strong></p><p><strong>scp</strong> -r local_folder remote_username@remote_ip:remote_folder</p><p>例：scp  -r  user  <a href="mailto:root@192.168.32.100" target="_blank" rel="noopener">root@192.168.32.100</a>:/opt/</p><h1 id="网络指令"><a href="#网络指令" class="headerlink" title="网络指令"></a>网络指令</h1><p>查看网络配置信息：<strong>ifconfig</strong></p><p>测试与目标主机的连通性：<strong>ping</strong> remote_ip</p><p><strong>显示各种网络相关信息</strong></p><p>命令：<strong>netstat</strong> </p><ul><li>-<strong>a</strong> (all)显示所有选项，默认不显示LISTEN相关</li><li>-<strong>t</strong> (tcp)仅显示tcp相关选项</li><li>-u (udp)仅显示udp相关选项</li><li>-<strong>n</strong> 拒绝显示别名，能显示数字的全部转化成数字。</li><li><p>-l 仅列出有在 Listen (监听) 的服務状态</p></li><li><p>-<strong>p</strong> 显示建立相关链接的程序名</p></li><li>-r 显示路由信息，路由表</li><li> -e 显示扩展信息，例如uid等</li><li>-s 按各个协议进行统计</li><li> -c 每隔一个固定时间，执行该netstat命令。</li></ul><h1 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h1><p><strong>修改主机名</strong></p><p>​    vim /etc/sysconfig/network    重启机器后才能生效</p><p>​    <img src="http://pg0l2q23d.bkt.clouddn.com/hosts.jpg" alt=""></p><p><strong>DNS配置</strong></p><p>​    hosts文件的作用相当于DNS，提供IP地址hostname的对应,可在这个文件里添加映射。域名解析</p><p>​    vi /etc/hosts<img src="http://pg0l2q23d.bkt.clouddn.com/hosts2.jpg" alt=""></p><p><strong>DNS服务器地址文件</strong>：/etc/resolv.conf</p><h1 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h1><p>Linux系统的环境变量是在<strong>/etc/profile</strong>文件里配置。</p><p>​    首先考虑一个问题，问什么我们先前敲的yum, service,date,useradd等等，可以直接使用，系统怎么知道这些命令对应的程序是放在哪里的呢？</p><p>​    这是由于无论是windows系统还是linux系统，都有一个叫做path的系统环境变量，当我们在敲命令时，系统会到path对应的目录下寻找，找到的话就会执行，找不到就会报没有这个命令。如下图：</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E7%8E%AF%E5%A2%831.png" alt=""></p><p>我们可以查看一下，系统一共在哪些目录里寻找命令对应的程序。</p><p>命令：echo $path</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E7%8E%AF%E5%A2%832.png" alt=""></p><p>​    </p><h1 id="服务操作"><a href="#服务操作" class="headerlink" title="服务操作"></a>服务操作</h1><p><strong>列出所有服务</strong>：chkconfig</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E6%9C%8D%E5%8A%A11.png" alt=""></p><p>各数字代表的系统初始化级别含义：</p><p>​        0：停机状态</p><p>　　1：单用户模式，root账户进行操作</p><p>　　2：多用户，不能使用net file system，一般很少用</p><p>　　3：完全多用户，一部分启动，一部分不启动，命令行界面</p><p>　　4：未使用、未定义的保留模式</p><p>　　5：图形化，3级别中启动的进程都启动，并且会启动一部分图形界面进程。</p><p>　　6：停止所有进程，卸载文件系统，重新启动(reboot)</p><p>　　这些级别中1、2、4很少用，相对而言0、3、5、6用的会较多。3级别和5级别除了桌面相关的进程外没有什么区别。为了减少资源占用，推荐都用3级别</p><p>注意 ：linux默认级别为3，不要把initdefault 设置为0 和 6 </p><h1 id="服务操作-1"><a href="#服务操作-1" class="headerlink" title="服务操作"></a>服务操作</h1><p><strong>service</strong> 服务名 start/stop/status/restart</p><p><strong>关闭防火墙</strong> ：service iptables start/stop/status</p><p><strong>服务初执行等级更改</strong>：    chkconfig –level 2345 name  off|on</p><p>​    若不加级别，默认是2345级别</p><p>​    命令：chkconfig name on|off</p><h1 id="进程操作"><a href="#进程操作" class="headerlink" title="进程操作"></a>进程操作</h1><p>查看所有进程：    <strong>ps</strong>  -aux</p><p>​    -a 列出所有</p><p>​       -u 列出用户</p><p>​       -x 详细列出，如cpu、内存等</p><p>​    - e </p><p>​     -f</p><p>命令： <strong>ps</strong>  - ef  |  <strong>grep</strong> ssh</p><p> 查看所有进程里CMD是ssh 的进程信息</p><p>杀死进程： <strong>kill</strong> pid </p><p><strong>-9</strong>：强制杀死</p><p>ps 命令先查出对应程序的PID或PPID ，然后杀死掉进程</p><h1 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h1><p>wget用法:wget [option] 网址  -O  指定下载保存的路径</p><p><strong>tar</strong> </p><p>​       -z    gzip进行解压或压缩，带.gz需要加，压缩出来.gz也需要加</p><p>​       -x    解压</p><p>​       -c    压缩</p><p>​       -f    目标文件，压缩文件新命名或解压文件名</p><p>​       -v   解压缩过程信息打印</p><p><strong>解压命令</strong>：tar  -zvxf  xxxx.tar.gz</p><p><strong>压缩命令</strong>：tar -zcf 压缩包命名 压缩目标</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Linux目录结构&quot;&gt;&lt;a href=&quot;#Linux目录结构&quot; class=&quot;headerlink&quot; title=&quot;Linux目录结构&quot;&gt;&lt;/a&gt;Linux目录结构&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://pg0l2q23d.bkt.clouddn.com
      
    
    </summary>
    
      <category term="Linux" scheme="http://www.dlhblog.online/categories/Linux/"/>
    
    
  </entry>
  
  <entry>
    <title>JDK8-Lambda</title>
    <link href="http://www.dlhblog.online/2018/10/27/JDK8-Lambda/"/>
    <id>http://www.dlhblog.online/2018/10/27/JDK8-Lambda/</id>
    <published>2018-10-27T12:42:25.000Z</published>
    <updated>2018-10-27T13:02:32.029Z</updated>
    
    <content type="html"><![CDATA[<p>​    Lambda 表达式是一个匿名函数， 我们可以把 Lambda 表达式理解为是一段可以传递的代码（将代码像数据一样进行传递）。 可以写出更简洁、 更灵活的代码。 作为一种更紧凑的代码风格， 使得 Java 语言表达能力得到了提升。Java8 中引入了一个新的操作符”-&gt;”该操作符称为箭头操作符或 Lambda 操作符， 箭头操作符将 Lambda表达式拆分为两部分：<br>​    左侧： Lambda 表达式的参数列表。 对应接口中抽象方法的参数列表。<br>​    右侧： Lambda 表达式中所需要执行的功能， 即 Lambda 体。 对应接口中抽象方法的实现 。</p><h1 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h1><h2 id="无参数无返回值"><a href="#无参数无返回值" class="headerlink" title="无参数无返回值"></a>无参数无返回值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 以前的写法</span></span><br><span class="line">    Runnable r1 = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"线程1在奔跑"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    r1.run();</span><br><span class="line">    System.out.println(<span class="string">"-----------------"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无参数，无返回值// 括号相当于new Runnable()；-&gt; 相当于run方法；后面是方法体</span></span><br><span class="line">    Runnable r2 = () -&gt; System.out.println(<span class="string">"线程2在奔跑"</span>);</span><br><span class="line">    r2.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的lambda表达式中，括号相当于new Runnable()；-&gt; 相当于run方法；后面是方法体</p><h2 id="有一个参数，无返回值"><a href="#有一个参数，无返回值" class="headerlink" title="有一个参数，无返回值"></a>有一个参数，无返回值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 有一个参数，无返回值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Consumer&lt;String&gt; consumer = (s) -&gt; System.out.println(s);</span><br><span class="line">    consumer.accept(<span class="string">"hello"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 只有一个参数时，括号可以不写，方法体中只有一行语句时，花括号可以不写</span></span><br><span class="line">Consumer&lt;String&gt; consumer = s -&gt; System.out.println(s);</span><br></pre></td></tr></table></figure><h2 id="有两个参数，方法体中有多条语句"><a href="#有两个参数，方法体中有多条语句" class="headerlink" title="有两个参数，方法体中有多条语句"></a>有两个参数，方法体中有多条语句</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 有两个参数，方法体中有多条语句</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Comparator&lt;Integer&gt; comparator = (x, y) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">        <span class="keyword">return</span> Integer.compare(x, y);</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(comparator.compare(<span class="number">4</span>, <span class="number">3</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Lambda表达式需要“函数式接口”的支持"><a href="#Lambda表达式需要“函数式接口”的支持" class="headerlink" title="Lambda表达式需要“函数式接口”的支持"></a>Lambda表达式需要“函数式接口”的支持</h1><p>​    接口中只有一个抽象方法的接口，称为函数式接口，其中静态方法和默认方法不算。</p><p>​    内置的函数式接口都有注解<code>@FunctionalInterface</code>修饰，可以使用该注解检查是否是函数式接口。</p><h2 id="自定义函数式接口"><a href="#自定义函数式接口" class="headerlink" title="自定义函数式接口"></a>自定义函数式接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义函数式接口</span></span><br><span class="line"><span class="comment"> * （只有一个抽象方法的接口，可以使用注解<span class="doctag">@FunctionalInterface</span>修饰检查）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test05</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用lamad表达式之前的形式</span></span><br><span class="line">    Integer res = operation(<span class="number">200</span>, <span class="keyword">new</span> MyFunction&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getValue</span><span class="params">(Integer o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> o * o;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(res);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用lamad表达式之后的形式</span></span><br><span class="line">    Integer result = operation(<span class="number">100</span>, x -&gt; x * x);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Integer <span class="title">operation</span><span class="params">(Integer num, MyFunction&lt;Integer&gt; mf)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mf.getValue(num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getValue</span><span class="params">(T o)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="四大内置核心函数式接口"><a href="#四大内置核心函数式接口" class="headerlink" title="四大内置核心函数式接口"></a>四大内置核心函数式接口</h1><p>消费性接口：需要给它一个参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Consumer&lt;T&gt;消费型接口</span></span><br><span class="line"><span class="comment"> * void accept(T t);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test06</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Consumer&lt;Integer&gt; consumer = <span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> </span>&#123;</span><br><span class="line">            System.out.println(integer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    consumer.accept(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    Consumer&lt;Integer&gt; consumer1 = (x) -&gt; System.out.println(x &lt; <span class="number">2</span>);</span><br><span class="line">    consumer1.accept(<span class="number">6</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>供给型接口：自己给你数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Supplier&lt;T&gt;供给型接口</span></span><br><span class="line"><span class="comment"> * T get();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test07</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Supplier&lt;Integer&gt; supplier = <span class="keyword">new</span> Supplier&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">int</span>) (Math.random() * <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(supplier.get());</span><br><span class="line"></span><br><span class="line">    Supplier&lt;Double&gt; sup = () -&gt; (Double) (Math.random() * <span class="number">100</span>);</span><br><span class="line">    System.out.println(sup.get());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 向集合中添加十个随机数并遍历</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test08</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Supplier&lt;Integer&gt; supplier = () -&gt; (<span class="keyword">int</span>) (Math.random() * <span class="number">10</span>);</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            list.add(supplier.get());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Integer integer : list)&#123;</span><br><span class="line">            System.out.print(integer+<span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>函数型接口：给它一个数据，返回一个数据，泛型中的类型要和传入返回的类型一致</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Function&lt;T,R&gt;函数型接口</span></span><br><span class="line"><span class="comment"> *      R apply(T t);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test09</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String str = <span class="string">"123456"</span>;</span><br><span class="line">    Function&lt;String,Integer&gt; function = (s) -&gt; Integer.valueOf(s);</span><br><span class="line">    System.out.println(function.apply(str));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>断言型接口：和其他断言一样，返回判断结果boolean类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Predicate&lt;T&gt;断言型接口</span></span><br><span class="line"><span class="comment"> *      boolean test(T t)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test10</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Predicate&lt;String&gt; predicate = (s)-&gt; s.contains(<span class="string">"a"</span>);</span><br><span class="line">    System.out.println(predicate.test(<span class="string">"test"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    Lambda 表达式是一个匿名函数， 我们可以把 Lambda 表达式理解为是一段可以传递的代码（将代码像数据一样进行传递）。 可以写出更简洁、 更灵活的代码。 作为一种更紧凑的代码风格， 使得 Java 语言表达能力得到了提升。Java8 中引入了一个新的操作符
      
    
    </summary>
    
      <category term="java" scheme="http://www.dlhblog.online/categories/java/"/>
    
    
  </entry>
  
  <entry>
    <title>Spring-Data-Redis操作redis服务器</title>
    <link href="http://www.dlhblog.online/2018/10/27/Spring-Data-Redis%E6%93%8D%E4%BD%9Credis%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>http://www.dlhblog.online/2018/10/27/Spring-Data-Redis操作redis服务器/</id>
    <published>2018-10-27T08:15:44.000Z</published>
    <updated>2018-10-27T08:22:32.469Z</updated>
    
    <content type="html"><![CDATA[<p>进行spring操作前，需要将redis配置中的所有127.0.0.1改为本机ip</p><h1 id="加入坐标依赖"><a href="#加入坐标依赖" class="headerlink" title="加入坐标依赖"></a>加入坐标依赖</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="添加application-xml配置文件"><a href="#添加application-xml配置文件" class="headerlink" title="添加application.xml配置文件"></a>添加application.xml配置文件</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 连接池配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPoolConfig"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最大连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"1024"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最大 空闲连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"200"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 获取连接时最大等待毫秒数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"10000"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 在获取连接时检查有效性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 客户端连接工厂 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisConnFactory"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:use-pool</span>=<span class="string">"true"</span> <span class="attr">p:host-name</span>=<span class="string">"192.168.1.38"</span> <span class="attr">p:port</span>=<span class="string">"6380"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:password</span>=<span class="string">"123456"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接池引用 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span> <span class="attr">ref</span>=<span class="string">"jedisPoolConfig"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- redisTemplate 配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.core.RedisTemplate"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">p:connection-factory-ref</span>=<span class="string">"jedisConnFactory"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置序列化操作 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"keySerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"valueSerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSpringDataRedis</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RedisTemplate&lt;String,Object&gt; redisTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ValueOperations valueOperations = redisTemplate.opsForValue();</span><br><span class="line">        valueOperations.set(<span class="string">"redis02"</span>, <span class="string">"hello redis"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">// 过期秒数实现</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BoundValueOperations&lt;String, Object&gt; Operations = redisTemplate.boundValueOps(<span class="string">"18236741290:12 3456"</span>);</span><br><span class="line">        Operations.append(<span class="string">"123456"</span>);</span><br><span class="line">        System.out.println(<span class="string">"验证码:"</span> + Operations.get());</span><br><span class="line">        <span class="comment">// 设置过期时间 60 秒后过期</span></span><br><span class="line">        Operations.expire(<span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Spring环境下读写分离配置"><a href="#Spring环境下读写分离配置" class="headerlink" title="Spring环境下读写分离配置"></a>Spring环境下读写分离配置</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 连接池配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPoolConfig"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最大连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"1024"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最大 空闲连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"200"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 获取连接时最大等待毫秒数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWaitMillis"</span> <span class="attr">value</span>=<span class="string">"10000"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 在获取连接时检查有效性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisSentinelConfiguration"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.RedisSentinelConfiguration"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"master"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.RedisNode"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"mymaster"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sentinels"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.RedisNode"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span> <span class="attr">value</span>=<span class="string">"192.168.1.38"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"6380"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.RedisNode"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span> <span class="attr">value</span>=<span class="string">"192.168.1.38"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"6379"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 客户端连接工厂 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisConnFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接池引用 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span> <span class="attr">ref</span>=<span class="string">"jedisPoolConfig"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"sentinelConfig"</span> <span class="attr">ref</span>=<span class="string">"redisSentinelConfiguration"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- redisTemplate 配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.core.RedisTemplate"</span> <span class="attr">p:connection-factory-ref</span>=<span class="string">"jedisConnFactory"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置序列化操作 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"keySerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"valueSerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashKeySerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.StringRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hashValueSerializer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisUtils"</span> <span class="attr">class</span>=<span class="string">"com.shsxt.utils.RedisUtils"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"redisTemplate"</span> <span class="attr">ref</span>=<span class="string">"redisTemplate"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;进行spring操作前，需要将redis配置中的所有127.0.0.1改为本机ip&lt;/p&gt;
&lt;h1 id=&quot;加入坐标依赖&quot;&gt;&lt;a href=&quot;#加入坐标依赖&quot; class=&quot;headerlink&quot; title=&quot;加入坐标依赖&quot;&gt;&lt;/a&gt;加入坐标依赖&lt;/h1&gt;&lt;figure 
      
    
    </summary>
    
      <category term="redis" scheme="http://www.dlhblog.online/categories/redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Redis-JAVA客户端</title>
    <link href="http://www.dlhblog.online/2018/10/27/Redis%E5%AE%A2%E6%88%B7%E7%AB%AF/"/>
    <id>http://www.dlhblog.online/2018/10/27/Redis客户端/</id>
    <published>2018-10-27T08:06:06.000Z</published>
    <updated>2018-10-27T08:15:15.699Z</updated>
    
    <content type="html"><![CDATA[<p>​    在前面我们添加的服务器访问密码和bind的设置就是为了连接客户端准备的。</p><h1 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="通过junit简单测试"><a href="#通过junit简单测试" class="headerlink" title="通过junit简单测试"></a>通过junit简单测试</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建redis客户端连接对象</span></span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"192.168.1.38"</span>, <span class="number">6380</span>);</span><br><span class="line">    <span class="comment">// 设置认证密码</span></span><br><span class="line">    jedis.auth(<span class="string">"123456"</span>);</span><br><span class="line">    <span class="comment">// 批量添加string类型数据</span></span><br><span class="line">    jedis.mset(<span class="string">"name"</span>, <span class="string">"zs"</span>, <span class="string">"age"</span>, <span class="string">"20"</span>, <span class="string">"address"</span>, <span class="string">"shanghai"</span>);</span><br><span class="line">    <span class="comment">// 获取缓存数据并输出</span></span><br><span class="line">    System.out.println(jedis.get(<span class="string">"name"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="通过redis连接池获取连接对象并操作服务器"><a href="#通过redis连接池获取连接对象并操作服务器" class="headerlink" title="通过redis连接池获取连接对象并操作服务器"></a>通过redis连接池获取连接对象并操作服务器</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化redis客户端连接池</span></span><br><span class="line">    JedisPool jedisPool = <span class="keyword">new</span> JedisPool(<span class="keyword">new</span> JedisPoolConfig(), <span class="string">"192.168.1.38"</span>, <span class="number">6380</span>, <span class="number">10000</span>, <span class="string">"123456"</span>);</span><br><span class="line">    <span class="comment">// 从连接池获取连接</span></span><br><span class="line">    Jedis jedis = jedisPool.getResource();</span><br><span class="line">    jedis.set(<span class="string">"name"</span>,<span class="string">"ls"</span>);</span><br><span class="line">    System.out.println(jedis.get(<span class="string">"name"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="封装RedisUtil对外提供连接对象获取方法"><a href="#封装RedisUtil对外提供连接对象获取方法" class="headerlink" title="封装RedisUtil对外提供连接对象获取方法"></a>封装RedisUtil对外提供连接对象获取方法</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// redis服务器ip</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String IP = <span class="string">"192.168.1.38"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// redis端口号</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> PORT = <span class="number">6380</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// redis服务器访问密码</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String AUTH = <span class="string">"123456"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可用连接实例的最大数目，默认值为8</span></span><br><span class="line"><span class="comment">     * 如果赋值为-1，则表示不限制；如果pool已经分配了maxActive个jedis实例，</span></span><br><span class="line"><span class="comment">     * 则此时pool的状态为exhausted(耗尽)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_ACTIVE = <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 控制一个pool最多有多少个状态为idle(空闲)的jedis实例，默认值为8</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_IDLE = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 等待可用连接的最大时间，单位毫秒，默认值为-1（永不超时）,如果超过等待时间</span></span><br><span class="line"><span class="comment">     * 则直接抛出JedisConnectionException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_WAIT = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> TIMEOUT = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在borrow一个jedis实例时，是否提前进行validate操作；如果为true，</span></span><br><span class="line"><span class="comment">     * 则得到的jedis实例均是可用的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> TEST_ON_BORROW = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JedisPool jedisPool = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化redis连接池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(MAX_ACTIVE);</span><br><span class="line">        config.setMaxIdle(MAX_IDLE);</span><br><span class="line">        config.setMaxWaitMillis(MAX_WAIT);</span><br><span class="line">        config.setTestOnBorrow(TEST_ON_BORROW);</span><br><span class="line">        jedisPool = <span class="keyword">new</span> JedisPool(config, IP, PORT, TIMEOUT, AUTH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisUtils</span><span class="params">(RedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Jedis实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Jedis <span class="title">getJedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != jedisPool) &#123;</span><br><span class="line">            Jedis resource = jedisPool.getResource();</span><br><span class="line">            <span class="keyword">return</span> resource;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放jedis资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">returnResource</span><span class="params">(<span class="keyword">final</span> Jedis jedis)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != jedis)</span><br><span class="line">            jedisPool.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Jedis客户端操作redis服务器"><a href="#Jedis客户端操作redis服务器" class="headerlink" title="Jedis客户端操作redis服务器"></a>Jedis客户端操作redis服务器</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJeditPool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        jedis = RedisUtils.getJedis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * string操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        jedis.set(<span class="string">"one"</span>, <span class="string">"hello"</span>);</span><br><span class="line">        jedis.append(<span class="string">"one"</span>, <span class="string">"world"</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"one"</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"---------------"</span>);</span><br><span class="line">        jedis.mset(<span class="string">"name"</span>, <span class="string">"zs"</span>, <span class="string">"age"</span>, <span class="string">"20"</span>, <span class="string">"id"</span>, <span class="string">"123456"</span>);</span><br><span class="line">        List&lt;String&gt; list = jedis.mget(<span class="string">"name"</span>, <span class="string">"age"</span>, <span class="string">"id"</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != list &amp;&amp; list.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String str : list) System.out.println(str + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"---------------"</span>);</span><br><span class="line">        jedis.incr(<span class="string">"age"</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"age"</span>));</span><br><span class="line">        jedis.incrBy(<span class="string">"age"</span>, <span class="number">10</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"age"</span>));</span><br><span class="line"></span><br><span class="line">        RedisUtils.returnResource(jedis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"id"</span>, <span class="string">"1"</span>);</span><br><span class="line">        map.put(<span class="string">"name"</span>, <span class="string">"zs"</span>);</span><br><span class="line">        map.put(<span class="string">"age"</span>, <span class="string">"20"</span>);</span><br><span class="line">        jedis.hmset(<span class="string">"user"</span>, map);</span><br><span class="line"></span><br><span class="line">        System.out.println(jedis.hmget(<span class="string">"user"</span>, <span class="string">"id"</span>, <span class="string">"name"</span>, <span class="string">"age"</span>));</span><br><span class="line"></span><br><span class="line">        jedis.hdel(<span class="string">"user"</span>, <span class="string">"age"</span>);</span><br><span class="line">        System.out.println(jedis.hexists(<span class="string">"user"</span>, <span class="string">"age"</span>));</span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; keys = jedis.hkeys(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">for</span> (String str : keys)</span><br><span class="line">            System.out.println(str + <span class="string">"-"</span> + jedis.hget(<span class="string">"user"</span>, str));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * list操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        jedis.lpush(<span class="string">"test"</span>, <span class="string">"h1"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"test"</span>, <span class="string">"h2"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"test"</span>, <span class="string">"h3"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(jedis.lrange(<span class="string">"test"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(jedis.lpop(<span class="string">"test"</span>));</span><br><span class="line">        System.out.println(jedis.lrange(<span class="string">"test"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        jedis.lrem(<span class="string">"test"</span>, <span class="number">0</span>, <span class="string">"h1"</span>);</span><br><span class="line">        jedis.lrem(<span class="string">"test"</span>, <span class="number">1</span>, <span class="string">"h2"</span>);</span><br><span class="line">        jedis.lrem(<span class="string">"test"</span>, <span class="number">2</span>, <span class="string">"h3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        jedis.sadd(<span class="string">"users"</span>, <span class="string">"zs"</span>);</span><br><span class="line">        jedis.sadd(<span class="string">"users"</span>, <span class="string">"ls"</span>);</span><br><span class="line">        jedis.sadd(<span class="string">"users"</span>, <span class="string">"ww"</span>);</span><br><span class="line">        System.out.println(jedis.smembers(<span class="string">"users"</span>));</span><br><span class="line">        System.out.println(jedis.sismember(<span class="string">"users"</span>, <span class="string">"zss"</span>));</span><br><span class="line">        System.out.println(jedis.srandmember(<span class="string">"users"</span>));</span><br><span class="line">        System.out.println(jedis.spop(<span class="string">"users"</span>));</span><br><span class="line">        System.out.println(jedis.scard(<span class="string">"users"</span>));</span><br><span class="line">        RedisUtils.returnResource(jedis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * sort set</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test05</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        jedis.zadd(<span class="string">"stu"</span>, <span class="number">100</span>, <span class="string">"zs"</span>);</span><br><span class="line">        jedis.zadd(<span class="string">"stu"</span>, <span class="number">30</span>, <span class="string">"ls"</span>);</span><br><span class="line">        jedis.zadd(<span class="string">"stu"</span>, <span class="number">60</span>, <span class="string">"ww"</span>);</span><br><span class="line">        System.out.println(jedis.zrange(<span class="string">"stu"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(jedis.zrevrange(<span class="string">"stu"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(jedis.zrangeByScore(<span class="string">"stu"</span>, <span class="number">50</span>, <span class="number">60</span>));</span><br><span class="line">        RedisUtils.returnResource(jedis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    在前面我们添加的服务器访问密码和bind的设置就是为了连接客户端准备的。&lt;/p&gt;
&lt;h1 id=&quot;添加依赖&quot;&gt;&lt;a href=&quot;#添加依赖&quot; class=&quot;headerlink&quot; title=&quot;添加依赖&quot;&gt;&lt;/a&gt;添加依赖&lt;/h1&gt;&lt;figure class=&quot;h
      
    
    </summary>
    
      <category term="redis" scheme="http://www.dlhblog.online/categories/redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Redis持久化</title>
    <link href="http://www.dlhblog.online/2018/10/27/Redis%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    <id>http://www.dlhblog.online/2018/10/27/Redis持久化/</id>
    <published>2018-10-27T07:39:12.000Z</published>
    <updated>2018-10-27T08:05:24.366Z</updated>
    
    <content type="html"><![CDATA[<p>对于 Redis,其提供了不同级别的持久化操作:<br>​    1、RDB 持久化可以在指定的时间间隔内生成数据集的时间点快照<br>​    2、AOF 持久化记录服务器执行的所有写操作命令， 并在服务器启动时， 通过重新执行这些命令来还原数据集。 AOF 文件中的命令全部以 Redis 协议的格式来保存， 新命令会被追加到文件的末尾。 Redis 还可以在后台对 AOF 文件进行重写（rewrite）， 使得 AOF文件的体积不会超出保存数据集状态所需的实际大小。</p><p>​    3、Redis 还可以同时使用 AOF 持久化和 RDB 持久化。在这种情况下， 当 Redis 重<br>启时,它会优先使用 AOF 文件来还原数据集,因为 AOF 文件保存的数据集通常比 RDB<br>文件所保存的数据集更完整。<br>​    4、持久化功能当然也可以进行关闭操作， 让数据仅在服务器运行时存在</p><h1 id="RDB-持久化操作（快照-SnapShot-方式）"><a href="#RDB-持久化操作（快照-SnapShot-方式）" class="headerlink" title="RDB 持久化操作（快照 SnapShot 方式）"></a>RDB 持久化操作（快照 SnapShot 方式）</h1><p>​    在默认情况下， Redis 将数据库快照保存在名字为 dump.rdb 的二进制文件中。当然， 这里可以通过修改redis.conf 配置文件来对数据存储条件进行定义， 规定在“ N 秒内数据集至少有 M 个改动”这一条件被满足时,自动保存一次数据集。 也可以通过调用 save 或 bgsave ,手动让 Redis 进行数据集保存操作 </p><p><img src="http://pg0l2q23d.bkt.clouddn.com/redis%E6%8C%81%E4%B9%85%E5%8C%961.jpg" alt=""></p><h2 id="Save-Bgsave-手动方式保存数据"><a href="#Save-Bgsave-手动方式保存数据" class="headerlink" title="Save |Bgsave 手动方式保存数据"></a>Save |Bgsave 手动方式保存数据</h2><p>通过 save 操作 ， 当前 io 操作被阻塞， 当 save 保存执行完毕才会进行后续 io 操作 </p><p><img src="http://pg0l2q23d.bkt.clouddn.com/redis%E6%8C%81%E4%B9%85%E5%8C%962.jpg" alt=""></p><p>save 操作执行成功后可以看到 dump.rdb 文件(在 root/usr/redis-4.0.9-master/src 目录下) </p><p><img src="http://pg0l2q23d.bkt.clouddn.com/redis%E6%8C%81%E4%B9%85%E5%8C%963.jpg" alt=""></p><h2 id="快照运行方式"><a href="#快照运行方式" class="headerlink" title="快照运行方式"></a>快照运行方式</h2><p>当 Redis 需要保存 dump.rdb 文件时， 服务器执行以下操作：</p><ol><li>Redis 调用 fork() ， 同时拥有父进程和子进程。</li><li>子进程将数据集写入到一个临时 RDB 文件中。</li><li>当子进程完成对新 RDB 文件的写入时， Redis 用新 RDB 文件替换原来的 RDB 文件， 并删除<br>旧的 RDB 文件。<br>RDB 优缺点</li></ol><p><em>优点</em>:</p><ol><li>RDB 是一个非常紧凑（compact） 的文件， 它保存了 Redis 在某个时间点上的数据集。 该文件<br>适合用于进行备份 。 比如说， 可以在最近的 24 小时内， 每小时备份一次 RDB 文件， 并且在每<br>个月的每一天， 也备份一个 RDB 文件。 这样的话， 即使遇上问题， 也可以随时将数据集还原到<br>不同的版本。</li><li>RDB 非常适用于灾难恢复（disaster recovery） ： 它只有一个文件， 并且内容都非常紧凑，<br>可以（在加密后） 将它传送到别的数据中心</li><li>RDB 可以最大化 Redis 的性能： 父进程在保存 RDB 文件时唯一要做的就是 fork 出一个子进<br>程， 然后这个子进程就会处理接下来的所有保存工作， 父进程无须执行任何磁盘 I/O 操作。</li><li>RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快</li></ol><p><em>缺点</em>:</p><ol><li>如果想要做到数据实时备份级别， 此时使用 rdb 快照进行备份可能会出现数据无法备份完整情况，<br>比如在数据备份完毕下次备份操作发起前， 服务器由于某种原因意外宕机， 此时采用 rdb 就无法<br>对当前情况做的实时响应处理</li><li>RDB 需要经常 fork 子进程来保存数据集到硬盘上,当数据集比较大的时候,fork 的过程是非常<br>耗时的,可能会导致Redis在一些毫秒级内不能响应客户端的请求.如果数据集巨大并且CPU性能<br>不是很好的情况下,这种情况会持续 1 秒,AOF 也需要 fork,但是你可以调节重写日志文件的频率<br>来提高数据集的耐久度. </li></ol><h1 id="AOF-只追加操作的文件"><a href="#AOF-只追加操作的文件" class="headerlink" title="AOF 只追加操作的文件"></a>AOF 只追加操作的文件</h1><p>​    RDB 需要经常 fork 子进程来保存数据集到硬盘上,当数据集比较大的时候,fork 的过程是非常耗时的,可能会导致 Redis 在一些毫秒级内不能响应客户端的请求.如果数据集巨大并且 CPU 性能不是很好的情况下,这种情况会持续 1 秒,AOF 也需要 fork,但是你可以调节重写日志文件的频率来提高数据集的耐久度.</p><p><code>appendonly yes</code></p><p>​    从现在开始， 每当 Redis 执行一个改变数据集的命令时（比如 SET） ， 这个命令就会被追加到 AOF 文件的末尾。 这样的话， 当 Redis 重新启时， 程序就可以通过重新执行AOF 文件中的命令来达到重建数据集的目的。</p><p><em>日志重写</em></p><p>​    因为 AOF 的运作方式是不断地将命令追加到文件的末尾， 所以随着写入命令的不断增加，AOF 文件的体积也会变得越来越大。 举个例子， 如果你对一个计数器调用了 100 次INCR ， 那么仅仅是为了保存这个计数器的当前值， AOF 文件就需要使用 100 条记录（entry） 。 然而在实际上， 只使用一条 SET 命令已经足以保存计数器的当前值了， 其余 99 条记录实际上都是多余的。</p><p>​    为了处理这种情况， Redis 支持一种有趣的特性： 可以在不打断服务客户端的情况下， 对AOF 文件进行重建（rebuild） 。 执行 BGREWRITEAOF 命令， Redis 将生成一个新的AOF 文件， 这个文件包含重建当前数据集所需的最少命令。 Redis 2.2 需要自己手动执行 BGREWRITEAOF 命令； Redis 2.4 则可以自动触发 AOF 重写。 参考:<br><a href="http://www.redis.cn/topics/persistence.html" target="_blank" rel="noopener">http://www.redis.cn/topics/persistence.html</a> </p><p>AOF重写文件配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 是否开启 AOF， 默认关闭（no）</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># 指定 AOF 文件名</span><br><span class="line">appendfilename appendonly.aof</span><br><span class="line"></span><br><span class="line"># Redis 支持三种不同的刷写模式：</span><br><span class="line"># appendfsync always #每次收到写命令就立即强制写入磁盘， 是最有保证的完全的持久化， 但速度也是最慢的， 一般不推荐使用。</span><br><span class="line">appendfsync everysec #每秒钟强制写入磁盘一次， 在性能和持久化方面做了很好的折中， 是受推荐的方式。</span><br><span class="line"># appendfsync no #完全依赖 OS 的写入， 一般为 30 秒左右一次， 性能最好但是持久化最没有保证， 不被推荐。</span><br><span class="line">#在日志重写时， 不进行命令追加操作， 而只是将其放在缓冲区里， 避免与命令的追加造成</span><br><span class="line">DISK IO 上的冲突。</span><br><span class="line">#设置为 yes 表示 rewrite 期间对新写操作不 fsync,暂时存在内存中,等 rewrite 完成后再写入， 默认为no</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line">#当前 AOF 文件大小是上次日志重写得到 AOF 文件大小的二倍时， 自动启动新的日志重写过程。</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"></span><br><span class="line">#当前 AOF 文件启动新的日志重写过程的最小值， 避免刚刚启动 Reids 时由于文件尺寸较小导致频繁的重写。</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;对于 Redis,其提供了不同级别的持久化操作:&lt;br&gt;​    1、RDB 持久化可以在指定的时间间隔内生成数据集的时间点快照&lt;br&gt;​    2、AOF 持久化记录服务器执行的所有写操作命令， 并在服务器启动时， 通过重新执行这些命令来还原数据集。 AOF 文件中的命令
      
    
    </summary>
    
      <category term="redis" scheme="http://www.dlhblog.online/categories/redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Redis哨兵机制(主备切换)</title>
    <link href="http://www.dlhblog.online/2018/10/27/Redis%E5%93%A8%E5%85%B5%E6%9C%BA%E5%88%B6/"/>
    <id>http://www.dlhblog.online/2018/10/27/Redis哨兵机制/</id>
    <published>2018-10-27T04:42:34.000Z</published>
    <updated>2018-10-27T07:37:29.180Z</updated>
    
    <content type="html"><![CDATA[<p>​    访问网站时为了提高响应速度，从内存中获取热点数据比从数据库中获取要快很多，Redis是一个很好的Cache工具，大型网站的热点数据往往巨大，此时一台Redis服务器内存无法满足，需要集合多台Redis，但只有一台主机，其他都是从服务器，实现读写分离。</p><p>​    但是，万一主机宕机或中断了怎么办。</p><p>​    Redis哨兵机制，对服务器进行监视，当主机‘挂’了的时候，它会从其他服务器中重新拥立一个新的主机，赋予可执行功能。当‘挂’掉的主机再重新启动后，就不再是主机了。</p><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>这里是单台服务器不同端口模拟3台服务器（1主2从）</p><h2 id="节点准备"><a href="#节点准备" class="headerlink" title="节点准备"></a>节点准备</h2><p>127.0.0.1  6379（master-主节点）</p><p>127.0.0.1  6380（slave-从节点1）</p><p>127.0.0.1  6381（slave-从节点2）</p><h2 id="主节点redis-conf配置"><a href="#主节点redis-conf配置" class="headerlink" title="主节点redis.conf配置"></a>主节点redis.conf配置</h2><p>设置端口 ， daemonize,密码， 连接主节点密码， requirepass 禁用 bind 等 基本配置 </p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E4%B8%BB1.jpg" alt=""></p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E4%B8%BB2.jpg" alt=""></p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E4%B8%BB3.jpg" alt=""></p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E4%B8%BB4.jpg" alt=""></p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E4%B8%BB5.jpg" alt=""></p><h2 id="从节点redis-conf配置"><a href="#从节点redis-conf配置" class="headerlink" title="从节点redis.conf配置"></a>从节点redis.conf配置</h2><p>从节点配置和主节点基本类似，相比多一个配置</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E5%93%A8%E5%85%B51.jpg" alt=""></p><h2 id="sentinel-conf哨兵文件配置"><a href="#sentinel-conf哨兵文件配置" class="headerlink" title="sentinel.conf哨兵文件配置"></a>sentinel.conf哨兵文件配置</h2><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E5%93%A8%E5%85%B5%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE1.jpg" alt=""></p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E5%93%A8%E5%85%B5%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE2.jpg" alt=""></p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E5%93%A8%E5%85%B51.jpg" alt=""></p><p>​                所有哨兵起先监视主机端口</p><p>​                为了方便快速看到效果，设置哨兵执行时效</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E5%93%A8%E5%85%B5%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE3.jpg" alt=""></p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E5%93%A8%E5%85%B5%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE4.jpg" alt=""></p><h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>开启所有三个服务和所有哨兵</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E5%93%A8%E5%85%B5%E5%90%AF%E5%8A%A8.jpg" alt=""></p><p>将主服务kill掉</p><p>结果发现端口号为6381的从服务成功谋朝篡位为主服务</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/6381%E6%88%90%E4%B8%BAmaster.jpg" alt=""></p><p>再次启动原本为主服务的6379</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/master-slave.jpg" alt=""></p><p>只能乖乖当6381的奴隶了吧~</p><p>这里的一切均为本机127.0.0.1测试，如果需要连接局域网，可以改为本机ip地址</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    访问网站时为了提高响应速度，从内存中获取热点数据比从数据库中获取要快很多，Redis是一个很好的Cache工具，大型网站的热点数据往往巨大，此时一台Redis服务器内存无法满足，需要集合多台Redis，但只有一台主机，其他都是从服务器，实现读写分离。&lt;/p&gt;
&lt;p
      
    
    </summary>
    
      <category term="redis" scheme="http://www.dlhblog.online/categories/redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Redis搭建主从复用-读写分离</title>
    <link href="http://www.dlhblog.online/2018/10/27/Redis%E6%90%AD%E5%BB%BA%E4%B8%BB%E4%BB%8E%E5%A4%8D%E7%94%A8-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/"/>
    <id>http://www.dlhblog.online/2018/10/27/Redis搭建主从复用-读写分离/</id>
    <published>2018-10-27T01:41:12.000Z</published>
    <updated>2018-10-27T04:40:59.086Z</updated>
    
    <content type="html"><![CDATA[<p>​    Redis 支持主从复用。 数据可以从主服务器向任意数量的从服务器上同步， 同步使用的是发布/订阅机制。 Mater Slave 的模式， 从 Slave 向 Master 发起 SYNC 命令。可以是 1 Master 多 Slave， 可以分层， Slave 下可以再接 Slave， 可扩展成树状结构。因为没有两台电脑， 所以只能在一台机器上搭建两个 Redis 服务端。这里使用单机来模拟 redis 主从服务器 ， 实现读写分离配置 。</p><p>​    由于之前redis5.0版本配置文件有些不同，选择了降低版本使用了4.0.9版本</p><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>将编译后的redis主文件夹复制两份，一份为master（主），一份slave（从），复制的命令为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rf redis-4.0.9 redis-4.0.9-slave</span><br></pre></td></tr></table></figure><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BB%E4%BB%8E%E5%88%86%E7%A6%BB%E6%96%87%E4%BB%B6%E5%A4%B9.jpg" alt=""></p><p>​        我们主要操作master和slave</p><h1 id="修改主服务器配置"><a href="#修改主服务器配置" class="headerlink" title="修改主服务器配置"></a>修改主服务器配置</h1><p>进入master目录，vim 编辑 redis.conf文件</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE.jpg" alt=""></p><p>修改完成后：wq保存并退出</p><h1 id="修改从服务器配置"><a href="#修改从服务器配置" class="headerlink" title="修改从服务器配置"></a>修改从服务器配置</h1><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A82.jpg" alt=""></p><p>添加设置作为谁的从服务器<img src="http://pg0l2q23d.bkt.clouddn.com/%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A81.jpg" alt=""></p><h1 id="启动服务器"><a href="#启动服务器" class="headerlink" title="启动服务器"></a>启动服务器</h1><p>先启动主服务master，到src目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-server ../redis.conf &amp;  ---以配置文件启动 ‘&amp;’---在后台运行</span><br></pre></td></tr></table></figure><p>然后启动从服务slave</p><h1 id="启动客户端"><a href="#启动客户端" class="headerlink" title="启动客户端"></a>启动客户端</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli</span><br></pre></td></tr></table></figure><p>从服务器需要以指定端口启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli -p 6380</span><br></pre></td></tr></table></figure><p>启动后输入<code>info replication</code>查看当前服务器状态</p><p>主服务器</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BBreplication.jpg" alt=""></p><p>从服务器</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%BB%8Ereplication.jpg" alt=""></p><p>​                看到这些信息基本配置好了，接下来进行测试</p><h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>主服务器 可读可写 ，我们添加一条数据，测试从服务器是否能读到</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%B8%BB%E6%B5%8B%E8%AF%95.jpg" alt=""></p><p>从服务器只有可读权限，关注它能否读取到主服务刚才写入的数据</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E4%BB%8E%E6%B5%8B%E8%AF%95.jpg" alt=""></p><p>测试发现无法写入，可以读取主服务写入的数据 ，成功。</p><p>下一章是配置哨兵机制~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    Redis 支持主从复用。 数据可以从主服务器向任意数量的从服务器上同步， 同步使用的是发布/订阅机制。 Mater Slave 的模式， 从 Slave 向 Master 发起 SYNC 命令。可以是 1 Master 多 Slave， 可以分层， Slave 
      
    
    </summary>
    
      <category term="redis" scheme="http://www.dlhblog.online/categories/redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Redis-五种数据类型</title>
    <link href="http://www.dlhblog.online/2018/10/27/redis-2/"/>
    <id>http://www.dlhblog.online/2018/10/27/redis-2/</id>
    <published>2018-10-27T00:46:41.000Z</published>
    <updated>2018-10-27T08:27:05.198Z</updated>
    
    <content type="html"><![CDATA[<h1 id="key-相关指令"><a href="#key-相关指令" class="headerlink" title="key 相关指令"></a>key 相关指令</h1><p>​    <strong>exists</strong> key 检测指定 key 是否存在， 返回 1 表示存在， 0 不存在<br>​    <strong>del</strong> key1 key2 …… keyN 删除给定 key,返回删除 key 的数目， 0 表示给定 key 都不存在<br>​    <strong>type</strong> key 返回给定 key 值的类型。 返回 none 表示 key 不存在,string 字符类型， list 链表类型 set 无序集合类型……<br>​    <strong>keys</strong> pattern 返回匹配指定模式的所有 key<br>​    <strong>randomkey</strong> 返回从当前数据库中随机选择的一个 key,如果当前数据库是空的， 返回空串<br>​    <strong>rename</strong> oldkey newkey 重命名一个 key,如果 newkey 存在， 将会被覆盖， 返回1 表示成功，0 失败。 可能是 oldkey 不存在或者和 newkey 相同。<br>​    <strong>renamenx</strong> oldkey newkey 同上， 但是如果 newkey 存在返回失败。<br>​    <strong>expire</strong> key seconds 为 key 指定过期时间， 单位是秒。 返回 1 成功， 0 表示key 已经设置超过过期时间或者不存在。<br>​    <strong>ttl</strong> key 返回设置过过期时间 key 的剩余过期秒数。 -1 表示 key 不存在或者未设置过期时间。<br>​    <strong>select</strong> db-index 通过索引选择数据库， 默认连接的数据库是 0,默认数据库数是16 个。 返回 1表示成功， 0 失败。<br>​    <strong>move</strong> key db-index 将 key 从当前数据库移动到指定数据库。 返回 1 表示成功。0 表示 key不存在或者已经在指定数据库中。 </p><h1 id="五种基本数据类型"><a href="#五种基本数据类型" class="headerlink" title="五种基本数据类型"></a>五种基本数据类型</h1><p>redis 提供五种数据类型： string,hash,list,set 及sorted set</p><h2 id="String-类型"><a href="#String-类型" class="headerlink" title="String 类型"></a>String 类型</h2><p>string 是最基本的类型， 而且 string 类型是二进制安全的。 意思是 redis 的<br>string 可以包含任何数据。 比如 jpg 图片或者序列化的对象。 从内部实现来看其实<br>string 可以看作 byte 组， 最大上限是 1G 字节。 1G=1024MB</p><h3 id="string-类型数据操作指令简介"><a href="#string-类型数据操作指令简介" class="headerlink" title="string 类型数据操作指令简介"></a>string 类型数据操作指令简介</h3><p>​    <strong>set</strong> key value 设置 key 对应 string 类型的值， 返回 1 表示成功， 0 失败。<br>​    <strong>setnx</strong> key value 如果 key 不存在， 设置 key 对应 string 类型的值。 如果key 已经存在， 返回 0。<br>​    <strong>get</strong> key 获取 key 对应的 string 值,如果 key 不存在返回 nil<br>​    <strong>getset</strong> key value 先获取 key 的值，再设置 key 的值。如果 key 不存在返回 nil。<br>​    <strong>mget</strong> key1 key2 ……keyN 一次获取多个 key 的值， 如果对应 key 不存在，则对应返回 nil。<br>​    <strong>mset</strong> key1 value1 ……keyN valueN 一次设置多个 key 的值， 成功返回 1表示所有的值都设置了， 失败返回0 表示没有任何值被设置。<br>​    <strong>msetnx</strong> key1 value1 ……keyN valueN 一次设置多个 key 的值， 但是不会覆盖已经存在的 key</p><p>​    <strong>incr</strong> key 对 key 的值做++操作， 并返回新的值。 注意 incr 一个不是 int 的value 会返回错误， incr 一个不存在的 key， 则设置 key 值为 1。<br>​    <strong>decr</strong> key 对 key 的值做–操作， decr 一个不存在 key， 则设置 key 值为-1。<strong>**<br>​    </strong>incrby<strong> key integer 对 key 加上指定值 ， key 不存在时候会设置 key， 并认为原来的 value 是 0。<br>​    </strong>decrby** key integer 对 key 减去指定值。 decrby 完全是为了可读性， 我们完全可以通过 incrby 一个负值来实现同样效果， 反之一样</p><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>​    String 是最常用的一种数据类型， 普通的 key/value 存储都可以归为此类， value 其实不仅是 String,也可以是数字： 比如想知道什么时候封锁一个 IP 地址(访问超过几次)。<strong>INCRBY</strong> 命令让这些变得很容易， 通过原子递增保持计数。 </p><h2 id="Hash-类型"><a href="#Hash-类型" class="headerlink" title="Hash 类型"></a>Hash 类型</h2><h3 id="Hash-类型数据操作指令"><a href="#Hash-类型数据操作指令" class="headerlink" title="Hash 类型数据操作指令"></a>Hash 类型数据操作指令</h3><p>​    <strong>hset</strong> key field value 设置 hash field 为指定值， 如果 key 不存在， 则创建<br>​    <strong>hget</strong> key field 获取指定的 hash field。<br>​    <strong>hmget</strong> key filed1….fieldN 获取全部指定的 hash filed。<br>​    <strong>hmset</strong> key filed1 value1 ……filedN valueN 同时设置hash的多个 field。<br>​    <strong>hincrby</strong> key field integer 将指定的 hash filed 加上指定值。 成功返回 hash filed 变更后的值。<br>​    <strong>hexists</strong> key field 检测指定 field 是否存在。<br>​    <strong>hdel</strong> key field 删除指定的 hash field。<br>​    <strong>hlen</strong> key 返回指定 hash 的 field 数量<br>​    <strong>hkeys</strong> key 返回 hash 的所有 field。<br>​    <strong>hvals</strong> key 返回 hash 的所有 value。<br>​    <strong>hgetall</strong> key 返回 hash 的所有 filed 和 value。</p><h3 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h3><p>​    我们简单举个实例来描述下 Hash 的应用场景， 比如我们要存储一个用户信息对象数据， 包含以下信息：用户 ID， 为查找的 key，存储的 value 用户对象包含姓名 name， 年龄 age， 生日 birthday 等信息，如果用普通的 key/value 结构来存储， 主要有以下 2 种存储方式：<br>​    <strong>第一种方式</strong>将用户ID作为查找key,把其他信息封装成一个对象以序列化的方式存储，如： set u001 “李三,18,20010101” 这种方式的缺点是， 增加了序列化/反序列化的开销， 并且在需要修改其中一项信息时， 需要把整个对象取回， 并且修改操作需要对并发进行保护， 引入 CAS 等复杂问题。<br>​    <strong>第二种方法</strong>是这个用户信息对象有多少成员就存成多少个 key-value 对儿， 用用户 ID+对应属性的名称作为唯一标识来取得对应属性的值，如： mset user:001:name “李三” user:001:age 18 user:001:birthday “20010101”虽然省去了序列化开销和并发问题， 但是用户 ID 为重复存储， 如果存在大量这样的数据， 内存浪费还是非常可观的。那么 Redis 提供的 Hash 很好的解决了这个问题， Redis 的 Hash 实际是内部存储的Value 为一个 HashMap，并提供了直接存取这个 Map 成员的接口，如： hmset user:001 name “李三” age 18 birthday “20010101” 也就是说， Key 仍然是用户 ID,value 是一个 Map， 这个 Map 的 key 是成员的属性名， value 是属性值，这样对数据的修改和存取都可以直接通过其内部 Map 的 Key(Redis 里称内部 Map 的 key 为 field), 也就是通过key(用户 ID) + field(属性标签) 操作对应属性数据了， 既不需要重复存储数据， 也不会带来序列化和并发修改控制的问题。 很好的解决了问题。这里同时需要注意， Redis 提供了接口(hgetall)可以直接取到全部的属性数据,但是如果内部 Map 的成员很多， 那么涉及到遍历整个内部 Map 的操作， 由于 Redis 单线程模型的缘故， 这个遍历操作可能会比较耗时， 而另其它客户端的请求完全不响应， 这点需要格外注意。</p><p><strong>实现方式</strong>：<br>​    上面已经说到 Redis Hash 对应 Value 内部实际就是一个 HashMap， 实际这里会有2 种不同实现， 这个 Hash的成员比较少时 Redis 为了节省内存会采用类似一维数组的方式来紧凑存储， 而不会采用真正的 HashMap 结构， 对应的 value redisObject 的encoding 为 zipmap,当成员数量增大时会自动转成真正的 HashMap。 </p><h2 id="List-类型"><a href="#List-类型" class="headerlink" title="List 类型"></a>List 类型</h2><h3 id="List-类型数据操作指令简介"><a href="#List-类型数据操作指令简介" class="headerlink" title="List 类型数据操作指令简介"></a>List 类型数据操作指令简介</h3><p>​    <strong>lpush</strong> key string 在 key 对应 list 的头部添加字符串元素， 返回 1 表示成功， 0表示 key 存在且不是 list 类型。<br>​    <strong>rpush</strong> key string 在 key 对应 list 的尾部添加字符串元素。<br>​    <strong>llen</strong> key 返回 key 对应 list 的长度， 如果 key 不存在返回 0， 如果 key 对应类型不是 list 返回错误。<br>​    <strong>lrange</strong> key start end 返回指定区间内的元素， 下标从 0 开始， 负值表示从后面计算， -1 表示倒数第一个元素 ， key 不存在返回空列表。<br>​    <strong>ltrim</strong> key start end 截取 list 指定区间内元素， 成功返回 1， key 不存在返回错误。<br>​    <strong>lset</strong> key indexvalue 设置 list 中指定下标的元素值， 成功返回 1， key 或者下标不存在返回错误。<br>​    <strong>lrem</strong> key count value 从 List 的头部 （ count 正数） 或尾部 （ count 负数）删除一定数量 （ count） 匹配 value 的元素， 返回删除的元素数量。 count 为 0时候删除全部。<br>​    <strong>lpop</strong> key 从 list 的头部删除并返回删除元素。 如果 key 对应 list 不存在或者是空返回 nil， 如果 key 对应值不是 list 返回错误。<br>​    <strong>rpop</strong> key 从 list 的尾部删除并返回删除元素。<br>​    <strong>blpop</strong> key1 ……keyN timeout 从左到右扫描， 返回对第一个非空 list 进行lpop 操作并返回， 比如 blpop list1 list2 list3 0 ,如果 list 不存在list2,list3 都是非空则对 list2 做 lpop 并返回从 list2 中删除的元素。 如果所有的 list 都是空或不存在， 则会阻塞 timeout 秒， timeout 为 0 表示一直阻塞。当阻塞时， 如果有 client 对 key1…keyN 中的任意 key 进行 push 操作， 则第一在这个 key 上被阻塞的 client 会立即返回。 如果超时发生， 则返回 nil。 有点像unix 的 select 或者 poll。</p><p>​    <strong>brpop</strong> 同 blpop， 一个是从头部删除一个是从尾部删除</p><h3 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h3><p>​    Redis list 的应用场景非常多， 也是 Redis 最重要的数据结构之一。<br>​    我们可以轻松地实现最新消息排行等功能。<br>​    Lists 的另一个应用就是队列， 可以利用 Lists 的 PUSH 操作， 将任务存在 List 中，然后工作线程再用 POP 操作将任务取出进行执行。</p><p><strong>实现方式</strong>：<br>​    Redis list 的实现为一个双向链表， 即可以支持反向查找和遍历， 更方便操作， 不过带来了部分额外的内存开销， Redis 内部的很多实现， 包括发送缓冲队列等也都是用的这个数据结构。 </p><h2 id="Set-类型"><a href="#Set-类型" class="headerlink" title="Set 类型"></a>Set 类型</h2><p>​    是无序集合， 最大可以包含(2 的 32 次方-1)个元素。 set 的是通过 hashtable 实现的， 所以添加， 删除， 查找的复杂度都是 O(1)。 hash table 会随着添加或者删除自动的调整大小。 需要注意的是调整 hashtable 大小时候需要同步（获取写锁）会阻塞其他读写操作。 可能不久后就会改用跳表（ skip list） 来实现。 跳表已经在 sortedsets 中使用了。 关于 set 集合类型除了基本的添加删除操作， 其它有用的操作还包含集合的取并集(union)， 交集(intersection)， 差集(difference)。通过这些操作可以很容易的实现 SNS 中的好友推荐和 blog 的 tag 功能</p><h3 id="set-类型数据操作指令简介"><a href="#set-类型数据操作指令简介" class="headerlink" title="set 类型数据操作指令简介"></a>set 类型数据操作指令简介</h3><p>​    <strong>sadd</strong> key member 添加一个 string 元素到 key 对应 set 集合中， 成功返回 1,如果元素以及在集合中则返回 0， key 对应的 set 不存在则返回错误。<br>​    <strong>srem</strong> key member 从 key 对应 set 中移除指定元素， 成功返回 1， 如果 member在集合中不存在或者 key 不存在返回 0， 如果 key 对应的不是 set 类型的值返回错误。<br>​    <strong>spop</strong> key 删除并返回 key 对应 set 中随机的一个元素,如果 set 是空或者 key不存在返回 nil。<br>​    <strong>srandmember</strong> key 同 spop， 随机取 set 中的一个元素， 但是不删除元素。<br>​    <strong>smove</strong> srckey dstkey member 从 srckey 对应 set 中移除 member 并添加到dstkey 对应 set 中， 整个操作是原子的。 成功返回 1,如果 member 在 srckey 中不存在返回 0， 如果 key 不是 set 类型返回错误。<br>​    <strong>Scard</strong> key 返回 set 的元素个数， 如果 set 是空或者 key 不存在返回 0。<br>​    <strong>sismember</strong> key member 判断 member 是否在 set 中， 存在返回 1， 0 表示不存在或者 key 不存在。<br>​    <strong>sinter</strong> key1 key2 …… keyN 返回所有给定 key 的交集。<br>​    <strong>sinterstore</strong> dstkey key1 ……. keyN 返回所有给定 key 的交集， 并保存交集存到 dstkey 下。<br>​    <strong>sunion</strong> key1 key2 …… keyN 返回所有给定 key 的并集。<br>​    <strong>sunionstore</strong> dstkey key1 ……keyN 返回所有给定 key 的并集， 并保存并集到 dstkey 下。<br>​    <strong>sdiff</strong> key1 key2 ……keyN 返回所有给定 key 的差集。<br>​    <strong>sdiffstore</strong> dstkey key1 ……keyN 返回所有给定 key 的差集， 并保存差集到 dstkey 下。<br>​    <strong>smembers</strong> key 返回 key 对应 set 的所有元素， 结果是无序的。</p><h3 id="应用场景-3"><a href="#应用场景-3" class="headerlink" title="应用场景"></a>应用场景</h3><p>​    Redis set 对外提供的功能与 list 类似是一个列表的功能， 特殊之处在于 set 是可以自动排重的， 当你需要存储一个列表数据， 又不希望出现重复数据时， set 是一个很好的选择， 并且 set 提供了判断某个成员是否在一个 set 集合内的重要接口， 这个也是 list所不能提供的。<br>​    比如在微博应用中， 每个人的好友存在一个集合（set） 中， 这样求两个人的共同好友的操作， 可能就只需要用求交集命令即可。 （新浪微博关注共同好友）</p><p>​    Redis 还为集合提供了求交集、 并集、 差集等操作。<br><strong>实现方式：</strong><br>​    set 的内部实现是一个 value 永远为 null 的 HashMap， 实际就是通过计算 hash的方式来快速排重的， 这也是 set 能提供判断一个成员是否在集合内的原因。 </p><h2 id="Sorted-Set-类型"><a href="#Sorted-Set-类型" class="headerlink" title="Sorted Set 类型"></a>Sorted Set 类型</h2><p>​    Sorted Set 是有序集合， 它在 set 的基础上增加了一个顺序属性， 这一属性在添加修改元素的时候可以指定， 每次指定后， 会自动重新按新的值调整顺序。 可以理解了有两列的 mysql 表， 一列存 value， 一列存顺序。 操作中 key 理解为sorted set 的名字， 最多包含 2&gt;32-1 个元素 。</p><h3 id="Sorted-Set-类型数据操作指令简介"><a href="#Sorted-Set-类型数据操作指令简介" class="headerlink" title="Sorted Set 类型数据操作指令简介"></a>Sorted Set 类型数据操作指令简介</h3><p>​    <strong>zadd</strong> key score member 添加元素到集合， 元素在集合中存在则更新对应 score。<br>​    <strong>zrem</strong> key member 删除指定元素， 1 表示成功， 如果元素不存在返回 0。<br>​    <strong>zincrby</strong> key incrmember 增加对应 member 的 score 值， 然后移动元素并保持 skip list 保持有序。 返回更新后的 score 值。<br>​    <strong>zrank</strong> key member 返回指定元素在集合中的排名（下标）， 集合中元素是按 score从小到大排序的。<br>​    <strong>zrevrankkey</strong> member 同上,但是集合中元素是按 score 从大到小排序。<br>​    <strong>zrange</strong> key start end 类似 lrange 操作从集合中去指定区间的元素。 返回的是有序结果<br>​    <strong>zrevrange</strong> key start end 同上， 返回结果是按 score 逆序的。<br>​    <strong>zrangebyscore</strong> key min max 返回集合中 score 在给定区间的元素。<br>​    <strong>zcount</strong> key min max 返回集合中 score 在给定区间的数量。<br>​    <strong>zcard</strong> key 返回集合中元素个数。<br>​    <strong>zscore</strong> key element 返回给定元素对应的 score</p><h3 id="应用场景-4"><a href="#应用场景-4" class="headerlink" title="应用场景"></a>应用场景</h3><p>​    以某个条件为权重， 比如按顶的次数排序.<strong>ZREVRANGE</strong> 命令可以用来按照得分来获取前 100 名的用户， <strong>ZRANK</strong> 可以用来获取用户排名， 非常直接而且操作容易。<br>​    <strong>Redis sorted set</strong> 的使用场景与 set 类似， 区别是 set 不是自动有序的， 而 sorted set 可以通过用户额外提供一个<strong>优先级(score)</strong>的参数来为成员排序， 并且是插入有序的，即自动排序。<br>​    比如:twitter 的 public timeline 可以以发表时间作为 <strong>score</strong> 来存储， 这样获取时就是自动按时间排好序的。<br>​    比如:全班同学成绩的 <strong>SortedSets</strong>， <strong>value</strong> 可以是同学的学号， 而 <strong>score</strong> 就可以是其考试得分， 这样数据插入集合的， 就已经进行了天然的排序。<br>​    比如网易云音乐排行榜实现；<br>​    另外还可以用 <strong>Sorted Sets</strong> 来做带权重的队列， 比如普通消息的 <strong>score</strong> 为 1， 重要消息的 <strong>score</strong> 为 2， 然后工作线程可以选择按 <strong>score</strong> 的倒序来获取工作任务。 让重要的任务优先执行。<br>需要精准设定过期时间的应用<br>​    比如你可以把上面说到的 <strong>sorted set</strong> 的 <strong>score</strong> 值设置成过期时间的时间戳， 那么就可以简单地通过过期时间排序， 定时清除过期数据了， 不仅是清除 Redis 中的过期数据，你完全可以把 Redis 里这个过期时间当成是对数据库中数据的索引， 用 Redis 来找出哪些数据需要过期删除， 然后再精准地从数据库中删除相应的记录。 </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;key-相关指令&quot;&gt;&lt;a href=&quot;#key-相关指令&quot; class=&quot;headerlink&quot; title=&quot;key 相关指令&quot;&gt;&lt;/a&gt;key 相关指令&lt;/h1&gt;&lt;p&gt;​    &lt;strong&gt;exists&lt;/strong&gt; key 检测指定 key 是否存在
      
    
    </summary>
    
      <category term="redis" scheme="http://www.dlhblog.online/categories/redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Redis简介和安装</title>
    <link href="http://www.dlhblog.online/2018/10/25/redis-1/"/>
    <id>http://www.dlhblog.online/2018/10/25/redis-1/</id>
    <published>2018-10-25T11:35:16.000Z</published>
    <updated>2018-10-27T08:26:53.681Z</updated>
    
    <content type="html"><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>​    Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）。    ——<a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></p><h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><ol><li><p>Redis 是把数据存放在内存当中， 所以它的运行速度会非常快</p></li><li><p>Redis 具有多种数据存储结构</p></li><li><p>Redis 具有持久化的功能</p></li><li><p>Redis 上的数据可以设置过期</p></li><li><p>Redis 支持集群， 而且可以自动切换</p></li><li><p>跨平台 支持多种语言客户端 </p></li></ol><p>   Redis 用途：<br>   ​    缓存（StackOverFlow）， 数据库(微博)， 消息中间件（队列， 微博） </p><h1 id="Redis安装"><a href="#Redis安装" class="headerlink" title="Redis安装"></a>Redis安装</h1><p>环境：centerOS 6.7 虚拟机</p><p>redis版本：5.0</p><p> 1、通过xshell建立连接，使用wget命令下载对应的节点资源</p><pre><code>wget http://download.redis.io/releases/redis-5.0.0.tar.gz</code></pre><p>​    或者去官网下载，使用xftp导入</p><p>2、安装gcc环境</p><p>​    yum install gcc</p><p>3、解压redis压缩文件</p><p>​    tar zxf redis-5.0.0.tar.gz </p><p>4、进入解压后的文件夹</p><p>​    make -编译</p><p>​    完成~</p><h1 id="启动redis服务"><a href="#启动redis服务" class="headerlink" title="启动redis服务"></a>启动redis服务</h1><p>进入src目录</p><p>./redis-server &amp;</p><p>在后面加上&amp;在启动服务后可以继续别的操作，否则以当前窗口启动无法进行其他操作。</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/redis01.bmp" alt=""></p><p>出现以上界面表示服务启动成功</p><p>启动客户端</p><p>./redis-cli</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/redis02.bmp" alt=""></p><p>启动成功就可以在里面愉快地敲命令了！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h1&gt;&lt;p&gt;​    Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，
      
    
    </summary>
    
      <category term="redis" scheme="http://www.dlhblog.online/categories/redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Crm项目-权限模块</title>
    <link href="http://www.dlhblog.online/2018/10/22/Crm%E9%A1%B9%E7%9B%AE%E6%9D%83%E9%99%90%E6%A8%A1%E5%9D%97/"/>
    <id>http://www.dlhblog.online/2018/10/22/Crm项目权限模块/</id>
    <published>2018-10-22T12:29:05.000Z</published>
    <updated>2018-10-22T13:47:04.195Z</updated>
    
    <content type="html"><![CDATA[<p>​    在这个项目中权限管理模块分为用户信息管理、角色管理、资源管理三个方面对不同用户的权限进行管理。</p><p>​    由于每个用户可以有多个角色，每个角色有多个模块权限，处理这些多对多的关系，建立了两张中间表，其中用户和角色之间的中间表，角色和权限的中间表，所以这里权限管理总共有五张表：</p><p>​    用户表：t_user 、 角色表：t_role 、 用户和角色的关系中间表：t_user_role</p><p>​    模块表：t_module 、角色和模块的关系中间表：t_permission</p><hr><p><strong>用户信息管理</strong></p><p>​    这里主要管理用户和用户的角色分配，通过中间表t_user_role中的userId和roleId对另外两张表关联</p><p>​    其中需要将多行数据显示到一行，使用了mysql的group_concat语法</p><p><strong>角色管理</strong></p><p>​    最主要的是关联权限，这里用了zTree插件建立了一棵权限树</p><p>​    <img src="http://pg0l2q23d.bkt.clouddn.com/crm%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-ztree.jpg" alt=""></p><p>​    通过t_permission中间表中的roleId和moduleId连接t_role和t_module两张表之间的关系</p><p>​    </p><p><strong>资源管理</strong></p><p><img src="http://pg0l2q23d.bkt.clouddn.com/crm%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86.jpg" alt=""></p><p>​    通过t_permission表和t_module表中的权限码关联</p><p>​    这个项目中权限码的设定是进行权限管理的关键</p><hr><p><strong>权限管理如何进行管理</strong></p><p>​    <strong>前台管理</strong>：freemake-所见即有权限</p><p>​    思路：</p><p>​        1、登录时根据用户id查询两张中间表中角色id相同的权限码（该用户拥有的权限码），并将结果存到session作用域中</p><p>​        2、前台模版引擎判断作用域中权限码是否存在和对应权限码显示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">#if</span> <span class="attr">permissions</span>??&gt;</span> <span class="comment">&lt;!--判断作用域存在的话才展示以下信息--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">#if</span> <span class="attr">permissions</span>?<span class="attr">seq_contains</span>("<span class="attr">10</span>")&gt;</span> <span class="comment">&lt;!--判断作用域中包含才展示以下信息--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">title</span>=<span class="string">"营销管理"</span> <span class="attr">data-options</span>=<span class="string">"selected:true,iconCls:'icon-yxgl'"</span> <span class="attr">style</span>=<span class="string">"padding: 10px"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">#if</span> <span class="attr">permissions</span>?<span class="attr">seq_contains</span>("<span class="attr">1010</span>")&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:openTab('营销机会管理','saleChance/index/1','icon-yxjhgl')"</span> <span class="attr">class</span>=<span class="string">"easyui-linkbutton"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">data-options</span>=<span class="string">"plain:true,iconCls:'icon-yxjhgl'"</span> <span class="attr">style</span>=<span class="string">"width: 150px"</span>&gt;</span>营销机会管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">#if</span> <span class="attr">permissions</span>?<span class="attr">seq_contains</span>("<span class="attr">1020</span>")&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:openTab('客户开发计划','saleChance/index/2','icon-khkfjh')"</span> <span class="attr">class</span>=<span class="string">"easyui-linkbutton"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">data-options</span>=<span class="string">"plain:true,iconCls:'icon-khkfjh'"</span> <span class="attr">style</span>=<span class="string">"width: 150px"</span>&gt;</span>客户开发计划<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br></pre></td></tr></table></figure><p>​    </p><p>​    <strong>后台管理</strong>：通过spring-aop+自定义注解进行统一管理</p><p>​    思路：</p><p>​        1、自定义注解</p><p>​        2、配置切面，对标记有该注解的注解中的值和session作用域中的内容进行比较判断，对不包含访问该资源所需权限码的行为进行拦截。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionAdaptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"@annotation(com.shsxt.crm.annotation.RequestPermission)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"cut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// 得到方法签名</span></span><br><span class="line">        MethodSignature signature = (MethodSignature) pjp.getSignature();</span><br><span class="line">        <span class="comment">// 通过方法签名拿到方法</span></span><br><span class="line">        Method method = signature.getMethod();</span><br><span class="line">        <span class="comment">// 通过方法拿到注解</span></span><br><span class="line">        RequestPermission requestPermission = method.getAnnotation(RequestPermission.class);</span><br><span class="line">        <span class="comment">// 拿到注解中的value</span></span><br><span class="line">        String aclValue = requestPermission.aclValue();</span><br><span class="line">        <span class="comment">// 通过spring线程的上下文获取request对象（也可以直接注入httpsession，我只是做测试）</span></span><br><span class="line">        ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request = requestAttributes.getRequest();</span><br><span class="line">        <span class="comment">// 通过request对象拿到session中的内容</span></span><br><span class="line">        List&lt;String&gt; permission = (List&lt;String&gt;) request.getSession().getAttribute(CrmConstant.USER_PERMISSIONS);</span><br><span class="line">        <span class="comment">// 判断集合中是否包含ACLValue拦截</span></span><br><span class="line">        AssertUtil.isTrue(CollectionUtils.isEmpty(permission) || !permission.contains(aclValue), <span class="string">"没有权限"</span>);</span><br><span class="line">        <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    在这个项目中权限管理模块分为用户信息管理、角色管理、资源管理三个方面对不同用户的权限进行管理。&lt;/p&gt;
&lt;p&gt;​    由于每个用户可以有多个角色，每个角色有多个模块权限，处理这些多对多的关系，建立了两张中间表，其中用户和角色之间的中间表，角色和权限的中间表，所以
      
    
    </summary>
    
      <category term="项目经验" scheme="http://www.dlhblog.online/categories/%E9%A1%B9%E7%9B%AE%E7%BB%8F%E9%AA%8C/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringMVC-异常处理</title>
    <link href="http://www.dlhblog.online/2018/10/12/SpringMVC%E5%AD%A6%E4%B9%A0-8/"/>
    <id>http://www.dlhblog.online/2018/10/12/SpringMVC学习-8/</id>
    <published>2018-10-12T03:16:19.000Z</published>
    <updated>2018-10-31T00:41:18.174Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringMVC处理全局异常"><a href="#SpringMVC处理全局异常" class="headerlink" title="SpringMVC处理全局异常"></a>SpringMVC处理全局异常</h1><p>1、使用SpringMVC提供的简单异常处理器SimpleMappingExceptionResolver</p><p>2、实现Spring的异常处理接口HandlerExceptionResolver定义自己的异常处理器</p><p>3、使用@ExceptionHandler 注解实现异常处理</p><h1 id="全局异常处理方式一"><a href="#全局异常处理方式一" class="headerlink" title="全局异常处理方式一"></a>全局异常处理方式一</h1><p>配置SimpleMappingExceptionResolver对象（配置servlet-context配置文件）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultErrorView"</span> <span class="attr">value</span>=<span class="string">"error"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionAttribute"</span> <span class="attr">value</span>=<span class="string">"ex"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionMappings"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"com.shsxt.exception.ParamException"</span>&gt;</span>param<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>​    优点：集成简单，有良好的扩展性，对已有代码没有入侵性等</p><p>​    缺点：该方法仅能获取到异常信息，若在出现异常时，对需要获取除异常以外的数据的情况不适用。</p><h1 id="全局异常处理方式二"><a href="#全局异常处理方式二" class="headerlink" title="全局异常处理方式二"></a>全局异常处理方式二</h1><p>定义自己的异常处理器，实现HandlerExceptionResolver接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">// 在需要使用时只需要加上这个注解交给spring管理即可</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         Object handler, Exception ex)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"============================="</span>);</span><br><span class="line">        System.out.println(<span class="string">"======MyExceptionHandler====="</span>);</span><br><span class="line">        System.out.println(<span class="string">"============================="</span>);</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        <span class="comment">// 当发生参数异常时instanceof--判断左边对象是否是右边类的实例</span></span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> ParamException)&#123;</span><br><span class="line">            <span class="comment">// 将异常转为参数异常</span></span><br><span class="line">            ParamException paramException = (ParamException) ex;</span><br><span class="line">            <span class="comment">// 设置视图页面</span></span><br><span class="line">            mv.setViewName(<span class="string">"param"</span>);</span><br><span class="line">            <span class="comment">// 设置模型数据</span></span><br><span class="line">            mv.addObject(<span class="string">"ex"</span>,ex);</span><br><span class="line">            <span class="keyword">return</span> mv;</span><br><span class="line">        &#125;</span><br><span class="line">        mv.setViewName(<span class="string">"error"</span>);</span><br><span class="line">        mv.addObject(<span class="string">"ex"</span>,ex);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    相比于配置SimpleMappingExceptionResolver对象方式，实现接口的方式能在异常处理时获取出现异常的对象，能提供更详细的异常处理信息</p><h1 id="全局异常处理方式三"><a href="#全局异常处理方式三" class="headerlink" title="全局异常处理方式三"></a>全局异常处理方式三</h1><p>定义异常处理器，使用@ExceptionHandler注解，页面处理器继承异常处理器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">ex</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                     Exception e)</span></span>&#123;</span><br><span class="line">        request.setAttribute(<span class="string">"ex"</span>,e);</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ParamException)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"param"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"index"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">ExceptionController</span></span>&#123;</span><br><span class="line">    <span class="comment">/*参数异常*/</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test01"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> ParamException(<span class="string">"参数异常"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    该方法需要修改已有代码，且受限于java单继承的局限性，在获取异常时不能获取除异常之外的数据</p><h1 id="未捕获异常的处理"><a href="#未捕获异常的处理" class="headerlink" title="未捕获异常的处理"></a>未捕获异常的处理</h1><p>​    对于Unchecked Exception而言，由于代码不强制捕获，往往被忽略，如果运行期产生了Unchecked Exception，而代码中又没有进行相应的捕获和处理，则我们可能不得不面对尴尬的404、500……等服务器内部错误提示页面。<br>​    我们需要一个全面而有效的异常处理机制。目前大多数服务器也都支持在Web.xml中通过<error-page>(Websphere/Weblogic)或者<error-code>(Tomcat)节点配置特定异常情况的显示页面。修改 web.xml 文件，增加以下内容：    </error-code></error-page></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 出错页面定义 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exception-type</span>&gt;</span>java.lang.Throwable<span class="tag">&lt;/<span class="name">exception-type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>/500.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>/500.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>/404.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SpringMVC处理全局异常&quot;&gt;&lt;a href=&quot;#SpringMVC处理全局异常&quot; class=&quot;headerlink&quot; title=&quot;SpringMVC处理全局异常&quot;&gt;&lt;/a&gt;SpringMVC处理全局异常&lt;/h1&gt;&lt;p&gt;1、使用SpringMVC提供的简单
      
    
    </summary>
    
      <category term="SpringMVC" scheme="http://www.dlhblog.online/categories/SpringMVC/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringMVC-SpringMVC实现RestFul服务</title>
    <link href="http://www.dlhblog.online/2018/10/12/SpringMVC%E5%AD%A6%E4%B9%A0-7/"/>
    <id>http://www.dlhblog.online/2018/10/12/SpringMVC学习-7/</id>
    <published>2018-10-12T02:59:05.000Z</published>
    <updated>2018-10-31T00:41:10.237Z</updated>
    
    <content type="html"><![CDATA[<p>​    Restful 风格的 API 是一种软件架构风格， 设计风格而不是标准， 只是提供了一组设计原则和约束条件。 它主要用于客户端和服务器交互类的软件。 基于这个风格设计的软件可以更简洁， 更有层次， 更易于实现缓存等机制。<br>​    在 Restful 风格中， 用户请求的 url 使用同一个 url 而用请求方式： get， post，delete， put…等方式对请求的处理方法进行区分， 这样可以在前后台分离式的开发中使得前端开发人员不会对请求的资源地址产生混淆和大量的检查方法名的麻烦， 形成一个统一的接口。</p><p><strong>在 Restful 风格中， 现有规定如下：</strong><br>​    GET（ SELECT） ： 从服务器查询， 可以在服务器通过请求的参数区分查询的方式。<br>​    POST（ CREATE） ： 在服务器端新建一个资源， 调用 insert 操作。<br>​    PUT（ UPDATE） ： 在服务器端更新资源， 调用 update 操作。<br>​    PATCH（ UPDATE） ： 在服务器端更新资源（ 客户端提供改变的属性） 。 (目前jdk7 未实现， tomcat7 不支持)。<br>​    DELETE（ DELETE） ： 从服务器端删除资源， 调用 delete 语句。</p><h1 id="Spring-Mvc-中对-rest-的支持"><a href="#Spring-Mvc-中对-rest-的支持" class="headerlink" title="Spring Mvc 中对 rest 的支持"></a>Spring Mvc 中对 rest 的支持</h1><p>案例：<br>​    如何在 java 构造没有扩展名的 RESTful url,如 /forms/1</p><h1 id="SpringMvc-Restful-风格-url-配置实现"><a href="#SpringMvc-Restful-风格-url-配置实现" class="headerlink" title="SpringMvc Restful 风格 url 配置实现"></a>SpringMvc Restful 风格 url 配置实现</h1><p>​    springmvc 的 resturl是通过@RequestMapping 及@PathVariable annotation提供的,通过如@RequestMapping(value=”/blog /{id}”,method=RequestMethod.DELETE)即可处理/blog/1 的 delete 请求. </p><h2 id="GET请求配置"><a href="#GET请求配置" class="headerlink" title="GET请求配置"></a>GET请求配置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * restful--&gt;get 请求 执行查询操作</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping</span>(value=<span class="string">"queryAccountById02/&#123;id&#125;"</span>,method= RequestMethod.GET,produces= MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> MessageModel <span class="title">queryAccountById</span><span class="params">(@PathVariable Integer id)</span></span>&#123;</span><br><span class="line">       MessageModel messageModel=<span class="keyword">new</span> MessageModel();</span><br><span class="line">       <span class="keyword">if</span>(<span class="keyword">null</span>==id)&#123;</span><br><span class="line">           messageModel.setCode(<span class="number">300</span>);</span><br><span class="line">           messageModel.setMsg(<span class="string">"参数非法!"</span>);</span><br><span class="line">           <span class="keyword">return</span> messageModel;</span><br><span class="line">       &#125;</span><br><span class="line">       messageModel.setResult(accountService.queryById(id));</span><br><span class="line">       <span class="keyword">return</span> messageModel;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="POST请求配置"><a href="#POST请求配置" class="headerlink" title="POST请求配置"></a>POST请求配置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* restful--&gt;post 请求执行添加操作</span></span><br><span class="line"><span class="comment"> * @param id</span></span><br><span class="line"><span class="comment"> * @param aname</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"saveAccount"</span>, method = RequestMethod.POST, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageModel <span class="title">queryAccountById04</span><span class="params">(@RequestBody Account account)</span> </span>&#123;</span><br><span class="line">    MessageModel messageModel = <span class="keyword">new</span> MessageModel();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        accountService.saveOrUpdateAccount(account);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ParamsException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        messageModel.setCode(e.getErrorCode());</span><br><span class="line">        messageModel.setMsg(e.getErrorMsg());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        messageModel.setCode(<span class="number">300</span>);</span><br><span class="line">        messageModel.setMsg(<span class="string">"操作失败!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> messageModel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Put请求配置"><a href="#Put请求配置" class="headerlink" title="Put请求配置"></a>Put请求配置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* restful--&gt;put 请求执行更新操作</span></span><br><span class="line"><span class="comment"> * @param id</span></span><br><span class="line"><span class="comment"> * @param account</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"update/&#123;id&#125;"</span>, method = RequestMethod.PUT, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageModel <span class="title">queryAccountById04</span><span class="params">(@PathVariable Integer id, @RequestBody Account account)</span> </span>&#123;</span><br><span class="line">    MessageModel messageModel = <span class="keyword">new</span> MessageModel();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        accountService.saveOrUpdateAccount(account);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ParamsException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        messageModel.setCode(e.getErrorCode());</span><br><span class="line">        messageModel.setMsg(e.getErrorMsg());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        messageModel.setCode(<span class="number">300</span>);</span><br><span class="line">        messageModel.setMsg(<span class="string">"操作失败!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> messageModel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Delete请求配置"><a href="#Delete请求配置" class="headerlink" title="Delete请求配置"></a>Delete请求配置</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* restful--&gt;delete 请求 执行删除操作</span></span><br><span class="line"><span class="comment"> * @param id</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"deleteAccountById/&#123;id&#125;"</span>, method = RequestMethod</span><br><span class="line">        .DELETE, produces = MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageModel <span class="title">queryAccountById05</span><span class="params">(@PathVariable Integer id)</span> </span>&#123;</span><br><span class="line">    MessageModel messageModel = <span class="keyword">new</span> MessageModel();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        accountService.deleteAccountById(id);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ParamsException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        messageModel.setCode(e.getErrorCode());</span><br><span class="line">        messageModel.setMsg(e.getErrorMsg());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        messageModel.setCode(<span class="number">300</span>);</span><br><span class="line">        messageModel.setMsg(<span class="string">"操作失败!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> messageModel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    Restful 风格的 API 是一种软件架构风格， 设计风格而不是标准， 只是提供了一组设计原则和约束条件。 它主要用于客户端和服务器交互类的软件。 基于这个风格设计的软件可以更简洁， 更有层次， 更易于实现缓存等机制。&lt;br&gt;​    在 Restful 风格
      
    
    </summary>
    
      <category term="SpringMVC" scheme="http://www.dlhblog.online/categories/SpringMVC/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringMVC-文件上传-SSM整合</title>
    <link href="http://www.dlhblog.online/2018/10/11/SpringMVC%E5%AD%A6%E4%B9%A0-6/"/>
    <id>http://www.dlhblog.online/2018/10/11/SpringMVC学习-6/</id>
    <published>2018-10-11T14:51:29.000Z</published>
    <updated>2018-10-31T00:41:02.802Z</updated>
    
    <content type="html"><![CDATA[<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="配置servlet-context-xml"><a href="#配置servlet-context-xml" class="headerlink" title="配置servlet-context.xml"></a>配置servlet-context.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>104857600<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxInMemorySize"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"file"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">fileUp</span><span class="params">(HttpServletRequest request, Model model)</span></span>&#123;</span><br><span class="line">        MultipartHttpServletRequest multRequest = (MultipartHttpServletRequest) request;</span><br><span class="line">        MultipartFile file = multRequest.getFile(<span class="string">"file"</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span>!=file &amp;&amp; !file.isEmpty())&#123;</span><br><span class="line">            String path = request.getSession().getServletContext().getRealPath(<span class="string">"upload"</span>);</span><br><span class="line">            String fileName = file.getOriginalFilename();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                file.transferTo(<span class="keyword">new</span> File(path,fileName));</span><br><span class="line">                model.addAttribute(<span class="string">"msg"</span>,<span class="string">"上传成功"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                model.addAttribute(<span class="string">"msg"</span>,<span class="string">"上传失败"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"fileUp"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">file</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"file"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="前台页面代码"><a href="#前台页面代码" class="headerlink" title="前台页面代码"></a>前台页面代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"file"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">contentType</span>=<span class="string">"text/html;charset=UTF-8"</span> <span class="attr">language</span>=<span class="string">"java"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>结果<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">操作：$&#123;msg&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>选择一个文件</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A01.jpg" alt=""></p><p>提交</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A02.jpg" alt=""></p><p>此时上传的文件已经在webapp/upload目录下</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A03.jpg" alt=""></p><p>关于SSM整合</p><p>整合完成的项目我已经放在GitHub上</p><p><a href="https://github.com/dlh1234okok/SSM" target="_blank" rel="noopener">https://github.com/dlh1234okok/SSM</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h1&gt;&lt;h2 id=&quot;添加依赖&quot;&gt;&lt;a href=&quot;#添加依赖&quot; class=&quot;headerlink&quot; title=&quot;添加依赖&quot;&gt;&lt;/a&gt;添加依赖&lt;/h
      
    
    </summary>
    
      <category term="SpringMVC" scheme="http://www.dlhblog.online/categories/SpringMVC/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringMVC-拦截器</title>
    <link href="http://www.dlhblog.online/2018/10/11/SpringMVC%E5%AD%A6%E4%B9%A0-5/"/>
    <id>http://www.dlhblog.online/2018/10/11/SpringMVC学习-5/</id>
    <published>2018-10-11T14:51:18.000Z</published>
    <updated>2018-10-31T00:40:55.570Z</updated>
    
    <content type="html"><![CDATA[<p>​    SpringMVC 中的 Interceptor 拦截器也是相当重要和相当有用的，它的主要作用是拦截用户的请求并进行相应的处理。比如通过它来进行权限验证，或者是来判断用户是否登陆等操作。</p><p>对于 springmvc 拦截器的定义方式有两种方式</p><ol><li><p>实现接口： org.springframework.web.servlet.HandlerInterceptor</p></li><li><p>继承适配器</p><p>org.springframework.web.servlet.handler.HandlerInterceptorAdapter </p></li></ol><h1 id="实现接口"><a href="#实现接口" class="headerlink" title="实现接口"></a>实现接口</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 请求方法执行前执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"method before..."</span>);</span><br><span class="line">        <span class="comment">// 请求地址</span></span><br><span class="line">        System.out.println(handler);</span><br><span class="line">        <span class="comment">// true代表放行，false拦截</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求方法执行后执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"method after..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 视图生成后执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"view after..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="继承HandlerInterceptorAdapter"><a href="#继承HandlerInterceptorAdapter" class="headerlink" title="继承HandlerInterceptorAdapter"></a>继承HandlerInterceptorAdapter</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor2</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"before preHandle..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"after completion"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="拦截器的配置"><a href="#拦截器的配置" class="headerlink" title="拦截器的配置"></a>拦截器的配置</h1><h2 id="全局拦截"><a href="#全局拦截" class="headerlink" title="全局拦截"></a>全局拦截</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.shsxt.interceptor.MyInterceptor"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="部分拦截（拦截指定请求）"><a href="#部分拦截（拦截指定请求）" class="headerlink" title="部分拦截（拦截指定请求）"></a>部分拦截（拦截指定请求）</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/user/*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.shsxt.interceptor.MyInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="简单的登录拦截"><a href="#简单的登录拦截" class="headerlink" title="简单的登录拦截"></a>简单的登录拦截</h1><h2 id="拦截器类代码"><a href="#拦截器类代码" class="headerlink" title="拦截器类代码"></a>拦截器类代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">        <span class="keyword">if</span> (uri.indexOf(<span class="string">"login"</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 判断Session是否存在（是否已登录）</span></span><br><span class="line">            User user = (User) request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != user) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                response.sendRedirect(request.getContextPath() + <span class="string">"/login.jsp"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="配置文件配置"><a href="#配置文件配置" class="headerlink" title="配置文件配置"></a>配置文件配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/*/*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.shsxt.interceptor.LoginInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p>还有一种方式：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/*/*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/user/login"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.shsxt.interceptor.LoginInterceptor2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这里已经放行了登录地址，所以拦截器代码不需要再获取请求地址判断。</p><h2 id="登录代码"><a href="#登录代码" class="headerlink" title="登录代码"></a>登录代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"login"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(User user, Model model, HttpSession session)</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String USERNAME=<span class="string">"zs"</span>;</span><br><span class="line">    <span class="keyword">final</span> String USERPWD=<span class="string">"123"</span>;</span><br><span class="line">    System.out.println(user.getUserName()+<span class="string">"+"</span>+user.getUserPwd());</span><br><span class="line">    <span class="keyword">if</span> (USERNAME.equals(user.getUserName()) &amp;&amp; USERPWD.equals(user.getUserPwd()))&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"登陆成功"</span>);</span><br><span class="line">        session.setAttribute(<span class="string">"user"</span>,user);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>,<span class="string">"帐号或密码错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>初次重启了服务器，Session不存在，输入简易查询的路径</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://localhost:8080/springmvc01/user/user01</span></span><br></pre></td></tr></table></figure><p>被拦截重定向到登录界面了<img src="http://pg0l2q23d.bkt.clouddn.com/%E6%8B%A6%E6%88%AA1.jpg" alt=""></p><p>当我们登录后再次进行查询</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E6%8B%A6%E6%88%AA2.jpg" alt=""></p><p>简易的登录拦截器就完成了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​    SpringMVC 中的 Interceptor 拦截器也是相当重要和相当有用的，它的主要作用是拦截用户的请求并进行相应的处理。比如通过它来进行权限验证，或者是来判断用户是否登陆等操作。&lt;/p&gt;
&lt;p&gt;对于 springmvc 拦截器的定义方式有两种方式&lt;/p&gt;

      
    
    </summary>
    
      <category term="SpringMVC" scheme="http://www.dlhblog.online/categories/SpringMVC/"/>
    
    
  </entry>
  
  <entry>
    <title>SpringMVC-requst,response和JSON格式</title>
    <link href="http://www.dlhblog.online/2018/10/11/SpringMVC%E5%AD%A6%E4%B9%A0-4/"/>
    <id>http://www.dlhblog.online/2018/10/11/SpringMVC学习-4/</id>
    <published>2018-10-11T14:51:13.000Z</published>
    <updated>2018-10-31T00:40:48.429Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JSON数据返回"><a href="#JSON数据返回" class="headerlink" title="JSON数据返回"></a>JSON数据返回</h1><p>@ResponseBody<br>​    该注解用于将 Controller 的方法返回的对象，通过适当的 HttpMessageConverter转换为指定格式后，写入到 Response 对象的 body 数据区。<br>​    返回的数据不是 html 标签的页面，而是其他某种格式的数据时（如 json、xml 等）使用（通常用于 ajax 请求）</p><p>@RequestBody<br>​    该注解用于读取 Request 请求的 body 部分数据，使用系统默认配置的HttpMessageConverter 进行解析，然后把相应的数据绑定到要返回的对象上 ,再把HttpMessageConverter 返回的对象数据绑定到 controller 中方法的参数上 </p><p><strong>步骤：</strong></p><p>1、添加json依赖jar包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加 json 依赖 jar 包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、修改servlet-context.xml 添加json转换器配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- json 支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageConverters"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在方法上定义@ResponseBody</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"view01"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">queryUser</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setId(id);</span><br><span class="line">    user.setUserName(<span class="string">"zs"</span>);</span><br><span class="line">    user.setUserPwd(<span class="string">"123"</span>);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看结果：</p><p><img src="http://pg0l2q23d.bkt.clouddn.com/%E9%87%8D%E5%AE%9A%E5%90%915.jpg" alt=""></p><h1 id="获取request和response对象"><a href="#获取request和response对象" class="headerlink" title="获取request和response对象"></a>获取request和response对象</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"user01"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">user01</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">                     HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                     HttpSession session)</span></span>&#123;</span><br><span class="line">    request.getParameter(<span class="string">"request"</span>);</span><br><span class="line">    response.addCookie(<span class="keyword">new</span> Cookie(<span class="string">"cookie"</span>,<span class="string">"a"</span>));</span><br><span class="line">    session.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;JSON数据返回&quot;&gt;&lt;a href=&quot;#JSON数据返回&quot; class=&quot;headerlink&quot; title=&quot;JSON数据返回&quot;&gt;&lt;/a&gt;JSON数据返回&lt;/h1&gt;&lt;p&gt;@ResponseBody&lt;br&gt;​    该注解用于将 Controller 的方法返回的
      
    
    </summary>
    
      <category term="SpringMVC" scheme="http://www.dlhblog.online/categories/SpringMVC/"/>
    
    
  </entry>
  
</feed>
